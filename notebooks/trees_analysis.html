
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Analysis &#8212; Vancouver Street Trees- Analysis through Importance Values</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Discussion" href="../docs/analysis_discussion.html" />
    <link rel="prev" title="Introduction" href="../docs/analysis_intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/Trees_pacific_spirit_ubc.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Vancouver Street Trees- Analysis through Importance Values</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    The Data Science Toolbox- Assignment 8- Daniel Stevens
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Exploration
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/exploration_intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="trees_EDA.html">
   Exploration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/exploration_discussion.html">
   Discussion
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Analysis
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/analysis_intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/analysis_discussion.html">
   Discussion
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/references.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/Daniel-J-Stevens/data-science-toolbox_assignment-8/master?urlpath=tree/van-trees_book/notebooks/trees_analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/trees_analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-imports">
   Data Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-summary">
   Data Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-validation">
   Data Validation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-cleansing">
   Data Cleansing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-1">
     Question 1:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-2">
     Question 2:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-3">
     Question 3:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-4">
     Question 4:
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-imports">
   Data Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-summary">
   Data Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-validation">
   Data Validation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-cleansing">
   Data Cleansing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-1">
     Question 1:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-2">
     Question 2:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-3">
     Question 3:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-4">
     Question 4:
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="analysis">
<h1>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">#</a></h1>
<section id="data-imports">
<h2>Data Imports<a class="headerlink" href="#data-imports" title="Permalink to this headline">#</a></h2>
<p>First, we will import the necessary libraries for our analyis as well as our data from the defined URLs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import necessary modules</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>

<span class="c1"># Enable data server</span>
<span class="n">alt</span><span class="o">.</span><span class="n">data_transformers</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s1">&#39;data_server&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataTransformerRegistry.enable(&#39;data_server&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data URLs</span>
<span class="n">url_vancouver_trees</span><span class="o">=</span><span class="s1">&#39;https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/vancouver_trees.csv&#39;</span>
<span class="n">url_geojson</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson&#39;</span>
<span class="n">url_neighbourhood_demographics</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/Daniel-J-Stevens/data-science-toolbox_assignment-8/main/van-trees_book/data/neighbourhood_demographics.csv&#39;</span>

<span class="c1"># Convert to TOPO json ** Code taken from &quot;Map Help for Final Project&quot; document **</span>
<span class="n">data_geojson_remote</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_geojson</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">(</span><span class="nb">property</span><span class="o">=</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">))</span>

<span class="c1"># Import as pandas dataframe</span>
<span class="n">trees_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url_vancouver_trees</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-summary">
<h2>Data Summary<a class="headerlink" href="#data-summary" title="Permalink to this headline">#</a></h2>
<p>Let’s take a look at some general characteristics of the <code class="docutils literal notranslate"><span class="pre">trees_df</span></code> dataframe. We will use the following python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trees_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_id_count</span> <span class="o">=</span> <span class="n">trees_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;tree_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;tree_id_count&quot;</span><span class="p">,</span><span class="n">tree_id_count</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">trees_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 30000 entries, 0 to 29999
Data columns (total 20 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   std_street          30000 non-null  object 
 1   on_street           30000 non-null  object 
 2   species_name        30000 non-null  object 
 3   neighbourhood_name  30000 non-null  object 
 4   date_planted        14085 non-null  object 
 5   diameter            30000 non-null  float64
 6   street_side_name    30000 non-null  object 
 7   genus_name          30000 non-null  object 
 8   assigned            30000 non-null  object 
 9   civic_number        30000 non-null  int64  
 10  plant_area          29722 non-null  object 
 11  curb                30000 non-null  object 
 12  tree_id             30000 non-null  int64  
 13  common_name         30000 non-null  object 
 14  height_range_id     30000 non-null  int64  
 15  on_street_block     30000 non-null  int64  
 16  cultivar_name       16178 non-null  object 
 17  root_barrier        30000 non-null  object 
 18  latitude            30000 non-null  float64
 19  longitude           30000 non-null  float64
dtypes: float64(3), int64(4), object(13)
memory usage: 4.6+ MB
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">trees_df</span></code> dataframe consists of <span class="pasted-inline"><code class="output text_plain docutils literal notranslate"><span class="pre">30000</span></code></span> rows, each representing a unique Vancouver street tree, and 20 columns of various dtypes including float, integer and object, each representing a different tree variable. Variable data types range from categorical (e.g. <code class="docutils literal notranslate"><span class="pre">genus_name</span></code>), quantitative (e.g. <code class="docutils literal notranslate"><span class="pre">diameter</span></code>), ordinal (e.g. <code class="docutils literal notranslate"><span class="pre">height_range_id</span></code>), temporal (e.g. <code class="docutils literal notranslate"><span class="pre">date_planted</span></code>) and spatial (e.g. <code class="docutils literal notranslate"><span class="pre">latitude</span></code>, <code class="docutils literal notranslate"><span class="pre">longitude</span></code>). There are missing values in the <code class="docutils literal notranslate"><span class="pre">date_planted</span></code>, <code class="docutils literal notranslate"><span class="pre">plant_area</span></code> and <code class="docutils literal notranslate"><span class="pre">cultivar_name</span></code> columns.</p>
<p>Let’s take a look at the descriptive statistics of the <code class="docutils literal notranslate"><span class="pre">trees_df</span></code> dataframe. We will use the following python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trees_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trees_describe</span> <span class="o">=</span> <span class="n">trees_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;analysis_trees_describe&quot;</span><span class="p">,</span><span class="n">trees_describe</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-default" id="analysis-trees-describe">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>diameter</th>
      <th>civic_number</th>
      <th>tree_id</th>
      <th>height_range_id</th>
      <th>on_street_block</th>
      <th>latitude</th>
      <th>longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>30000.000000</td>
      <td>30000.000000</td>
      <td>30000.000000</td>
      <td>30000.000000</td>
      <td>30000.000000</td>
      <td>30000.000000</td>
      <td>30000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>12.204926</td>
      <td>2974.397233</td>
      <td>128252.088500</td>
      <td>2.717967</td>
      <td>2948.410767</td>
      <td>49.247574</td>
      <td>-123.106173</td>
    </tr>
    <tr>
      <th>std</th>
      <td>9.334234</td>
      <td>2068.223585</td>
      <td>75099.139102</td>
      <td>1.555819</td>
      <td>2069.837551</td>
      <td>0.021178</td>
      <td>0.049450</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>29.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>49.200732</td>
      <td>-123.223870</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.250000</td>
      <td>1319.000000</td>
      <td>62110.250000</td>
      <td>2.000000</td>
      <td>1300.000000</td>
      <td>49.230519</td>
      <td>-123.144596</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>10.000000</td>
      <td>2646.000000</td>
      <td>129058.000000</td>
      <td>2.000000</td>
      <td>2600.000000</td>
      <td>49.248200</td>
      <td>-123.104022</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>17.250000</td>
      <td>4063.250000</td>
      <td>190963.750000</td>
      <td>4.000000</td>
      <td>4100.000000</td>
      <td>49.263808</td>
      <td>-123.062734</td>
    </tr>
    <tr>
      <th>max</th>
      <td>317.000000</td>
      <td>9201.000000</td>
      <td>271025.000000</td>
      <td>10.000000</td>
      <td>9200.000000</td>
      <td>49.294528</td>
      <td>-123.018258</td>
    </tr>
  </tbody>
</table>
</div></div></div>
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Descriptive statistics of <code class="docutils literal notranslate"><span class="pre">trees_df</span></code> dataframe.</span><a class="headerlink" href="#analysis-trees-describe" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The mean diameter of the observed trees as seen in <a class="reference internal" href="#analysis-trees-describe"><span class="std std-numref">Fig. 17</span></a> is 12.20 inches, while the median diameter is 10.00 inches, indicating that the distribution of tree diameter for the full dataset is right-skewed. The maximum diameter is 317.00 inches (over 26 ft), while the minimum diameter is 0.00 inches. These maximum and minimum values both appear unreasonable and will require further investigation to determine their validity.</p>
</section>
<section id="data-validation">
<h2>Data Validation<a class="headerlink" href="#data-validation" title="Permalink to this headline">#</a></h2>
<p>Let’s create a rug plot to quickly visualize the distribution of tree diameter.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analysis_rug</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">url_vancouver_trees</span><span class="p">)</span><span class="o">.</span><span class="n">mark_tick</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;diameter:Q&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;analysis_rug&quot;</span><span class="p">,</span><span class="n">analysis_rug</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-default" id="analysis-rug">
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-7ac0235a3f7c4b9dbde9ac33d3b4ffbc"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-7ac0235a3f7c4b9dbde9ac33d3b4ffbc") {
      outputDiv = document.getElementById("altair-viz-7ac0235a3f7c4b9dbde9ac33d3b4ffbc");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/vancouver_trees.csv"}, "mark": "tick", "encoding": {"x": {"field": "diameter", "type": "quantitative"}}, "width": 800, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"mode": "vega-lite"});
</script></div></div>
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Distribution of Vancouver street tree diameters.</span><a class="headerlink" href="#analysis-rug" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The rugplot in <a class="reference internal" href="#analysis-rug"><span class="std std-numref">Fig. 18</span></a> looks fairly saturated until approximately 60 inches.</p>
<p>Let’s filter the data and inspect observations with diameter values exceeding 60 inches, as well as observations with diameter values equaling 0. We will encode the latitude and longitude of these points into a google maps search to allow for easy validation of their measurements through visual inspection.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_map</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_geojson_remote</span><span class="p">)</span><span class="o">.</span><span class="n">mark_geoshape</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<span class="p">)</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;identity&#39;</span><span class="p">,</span> <span class="n">reflectY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">diameter_outliers</span><span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">url_vancouver_trees</span><span class="p">)</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">tree_url</span><span class="o">=</span> <span class="s1">&#39;https://maps.google.com/?q=&#39;</span><span class="o">+</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">latitude</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">longitude</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">latitude</span><span class="o">=</span><span class="s1">&#39;latitude:Q&#39;</span><span class="p">,</span>
    <span class="n">longitude</span><span class="o">=</span><span class="s1">&#39;longitude:Q&#39;</span><span class="p">,</span>
    <span class="n">href</span><span class="o">=</span><span class="s1">&#39;tree_url:N&#39;</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s1">&#39;tree_id:N&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Tree ID&#39;</span><span class="p">),</span>
             <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s1">&#39;common_name:N&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Common name&#39;</span><span class="p">),</span>
             <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s1">&#39;neighbourhood_name:N&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Neighbourhood&#39;</span><span class="p">),</span>
             <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s1">&#39;diameter:Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Diameter&#39;</span><span class="p">),</span>
             <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s1">&#39;tree_url:N&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Google maps&#39;</span><span class="p">)],</span>
    <span class="n">size</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="s1">&#39;diameter:Q&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">400</span><span class="p">]),</span> <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tree Diameter (in)&quot;</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">((</span><span class="s1">&#39;(datum.diameter== 0) | (datum.diameter &gt; 60)&#39;</span><span class="p">))</span>

<span class="n">diameter_outliers_layered</span> <span class="o">=</span> <span class="p">(</span><span class="n">base_map</span> <span class="o">+</span> <span class="n">diameter_outliers</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span> <span class="s1">&#39;Tree Diameter Outliers in Vancouver Street Tree Population&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">configure_view</span><span class="p">(</span><span class="n">strokeWidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;diameter_outliers_layered&quot;</span><span class="p">,</span><span class="n">diameter_outliers_layered</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-default" id="diameter-outliers-layered">
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-d5ef2f6a135041ed998a37a9fc5dee15"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d5ef2f6a135041ed998a37a9fc5dee15") {
      outputDiv = document.getElementById("altair-viz-d5ef2f6a135041ed998a37a9fc5dee15");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300, "strokeWidth": 0}}, "layer": [{"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson", "format": {"property": "features", "type": "json"}}, "mark": {"type": "geoshape", "fill": null, "stroke": "black"}, "encoding": {}, "projection": {"reflectY": true, "type": "identity"}}, {"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/vancouver_trees.csv"}, "mark": {"type": "circle", "color": "green", "size": 80}, "encoding": {"href": {"field": "tree_url", "type": "nominal"}, "latitude": {"field": "latitude", "type": "quantitative"}, "longitude": {"field": "longitude", "type": "quantitative"}, "size": {"field": "diameter", "legend": {"title": "Tree Diameter (in)"}, "scale": {"domain": [-20, 400]}, "type": "quantitative"}, "tooltip": [{"field": "tree_id", "title": "Tree ID", "type": "nominal"}, {"field": "common_name", "title": "Common name", "type": "nominal"}, {"field": "neighbourhood_name", "title": "Neighbourhood", "type": "nominal"}, {"field": "diameter", "title": "Diameter", "type": "quantitative"}, {"field": "tree_url", "title": "Google maps", "type": "nominal"}]}, "transform": [{"calculate": "((('https://maps.google.com/?q=' + datum.latitude) + ',') + datum.longitude)", "as": "tree_url"}, {"filter": "(datum.diameter== 0) | (datum.diameter > 60)"}]}], "title": "Tree Diameter Outliers in Vancouver Street Tree Population", "width": 800, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"mode": "vega-lite"});
</script></div></div>
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">Tree Diameter Outliers in Vancouver Street Tree Population</span><a class="headerlink" href="#diameter-outliers-layered" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Let’s start off with tree ID <code class="docutils literal notranslate"><span class="pre">43236</span></code>, listed as a <i>Pissard Plum</i> with a diameter of 0 inches as seen in the Oakridge neighbourhood of <a class="reference internal" href="#diameter-outliers-layered"><span class="std std-numref">Fig. 19</span></a> :</p>
<figure class="align-default" id="tree-id-043236-analysis">
<a class="reference internal image-reference" href="../_images/tree-id_043236.png"><img alt="../_images/tree-id_043236.png" src="../_images/tree-id_043236.png" style="height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Tree ID <code class="docutils literal notranslate"><span class="pre">43236</span></code>, Pissard Plum, <em>Oakridge</em> <a class="reference internal" href="../docs/references.html#tree-id-043236-ref"><span class="std std-ref">(“Lat:49.227653, Long:-123.109172. Vancouver, BC.”)</span></a></span><a class="headerlink" href="#tree-id-043236-analysis" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Upon inspection of <a class="reference internal" href="#tree-id-043236-analysis"><span class="std std-numref">Fig. 20</span></a>, it is evident that this tree is not close to 0 inches in diameter.</p>
<p>Next let’s look at tree ID <code class="docutils literal notranslate"><span class="pre">149285</span></code> which lies at the other end of the diameter outlier spectrum. This tree is the largest tree listed in the dataset, categorized as a <i>Maple Species</i> with a diameter of 317 inches (over 26 feet) as seen in the Kitsilano neighbourhood of <a class="reference internal" href="#diameter-outliers-layered"><span class="std std-numref">Fig. 19</span></a>:</p>
<figure class="align-default" id="tree-id-149285-analysis">
<a class="reference internal image-reference" href="../_images/tree-id_149285.png"><img alt="../_images/tree-id_149285.png" src="../_images/tree-id_149285.png" style="height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Tree ID <code class="docutils literal notranslate"><span class="pre">149285</span></code>, Maple Species, <em>Kitsilano</em> <a class="reference internal" href="../docs/references.html#tree-id-149285-ref"><span class="std std-ref">(“Lat:49.258939, Long:-123.148375. Vancouver, BC.”)</span></a></span><a class="headerlink" href="#tree-id-149285-analysis" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>It is obvious from <a class="reference internal" href="#tree-id-149285-analysis"><span class="std std-numref">Fig. 21</span></a> that the tree does not have a diameter of more than 26 feet.</p>
<p>The diameters of tree IDs <code class="docutils literal notranslate"><span class="pre">43236</span></code> and <code class="docutils literal notranslate"><span class="pre">149285</span></code> are evidently inaccurate, and thus can bet removed from the dataset.</p>
<p>Upon examination of the remaining trees in <a class="reference internal" href="#diameter-outliers-layered"><span class="std std-numref">Fig. 19</span></a> through Google Maps streetview, we can see that a majority of the diameter measurements are inaccurate, however, the validity of some diameters are more ambiguous. As an example, let’s look at tree ID 93845, listed as a <i>Deodar Cedar</i> with a diameter of 71 inches as seen in the Kitsilano neighbourhood of <a class="reference internal" href="#diameter-outliers-layered"><span class="std std-numref">Fig. 19</span></a>:</p>
<figure class="align-default" id="tree-id-093845-analysis">
<a class="reference internal image-reference" href="../_images/tree-id_093845.png"><img alt="../_images/tree-id_093845.png" src="../_images/tree-id_093845.png" style="height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 22 </span><span class="caption-text">Tree ID 93845, Deodar Cedar, <em>Kitsilano</em> <a class="reference internal" href="../docs/references.html#tree-id-093845-ref"><span class="std std-ref">(“Lat:49.273067, Long:-123.150309. Vancouver, BC.”)</span></a></span><a class="headerlink" href="#tree-id-093845-analysis" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>This is a multi-stemmed tree with an overall diameter of 71 inches, the three individual stems each having a smaller diameter. In a study examining methods of multi-stemmed tree measurement, Magarik et al found that there was no significant difference in the predictive power of overall diameter in regards to tree height and crown width of multi-stemmed trees <a class="reference internal" href="../docs/references.html#magarik-2020"><span class="std std-ref">(Magarik et al 2020)</span></a>. For this reason, we can feel justified in keeping these trees as part of the dataset.</p>
<p>Of the outliers present in <a class="reference internal" href="#diameter-outliers-layered"><span class="std std-numref">Fig. 19</span></a> , tree IDs <code class="docutils literal notranslate"><span class="pre">87265</span></code>, <code class="docutils literal notranslate"><span class="pre">168648</span></code>, <code class="docutils literal notranslate"><span class="pre">142102</span></code>, <code class="docutils literal notranslate"><span class="pre">142079</span></code> and <code class="docutils literal notranslate"><span class="pre">126267</span></code> can be kept as part of the data set as their listed diameters are reasonable based on visualization through Google Maps. The remaining outlier trees can be removed from the analysis.</p>
<p>Although this method is not the most robust as far as outlier detection and removal, it is adequate for the scope of this analysis.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diameter_outlier_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">43236</span><span class="p">,</span> <span class="mi">158784</span><span class="p">,</span> <span class="mi">191867</span><span class="p">,</span> <span class="mi">188673</span><span class="p">,</span>
    <span class="mi">188672</span><span class="p">,</span> <span class="mi">222821</span><span class="p">,</span> <span class="mi">85182</span><span class="p">,</span> <span class="mi">93845</span><span class="p">,</span>
    <span class="mi">71403</span><span class="p">,</span> <span class="mi">128151</span><span class="p">,</span> <span class="mi">23759</span><span class="p">,</span> <span class="mi">78588</span><span class="p">,</span>
    <span class="mi">51001</span><span class="p">,</span> <span class="mi">149285</span>
                    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we will analyse the validity of the <code class="docutils literal notranslate"><span class="pre">neighbourhood_name</span></code> variable by creating a point map using the latitude and longitude of each tree and faceting by neighbourhood. Any points lying outside of the neighbourhood boundary will be removed from the analysis as the data within the observation is not internally consistent.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neighbourhood_trees</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">latitude</span><span class="o">=</span><span class="s1">&#39;latitude:Q&#39;</span><span class="p">,</span>
    <span class="n">longitude</span><span class="o">=</span><span class="s1">&#39;longitude:Q&#39;</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s1">&#39;tree_id:N&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Tree ID&#39;</span><span class="p">)]</span>
<span class="p">)</span>

<span class="n">neighbourhood_outlier_map</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">base_map</span><span class="p">,</span> <span class="n">neighbourhood_trees</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">url_vancouver_trees</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s1">&#39;neighbourhood_name:N&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">configure_view</span><span class="p">(</span><span class="n">strokeWidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;neighbourhood_outlier_map&quot;</span><span class="p">,</span><span class="n">neighbourhood_outlier_map</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-default" id="neighbourhood-outlier-map">
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-657409e7f57a4f8ebd0b4eaf5c2f6a2a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-657409e7f57a4f8ebd0b4eaf5c2f6a2a") {
      outputDiv = document.getElementById("altair-viz-657409e7f57a4f8ebd0b4eaf5c2f6a2a");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300, "strokeWidth": 0}}, "data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/vancouver_trees.csv"}, "facet": {"field": "neighbourhood_name", "type": "nominal"}, "spec": {"layer": [{"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson", "format": {"property": "features", "type": "json"}}, "mark": {"type": "geoshape", "fill": null, "stroke": "black"}, "encoding": {}, "projection": {"reflectY": true, "type": "identity"}}, {"mark": {"type": "circle", "color": "green", "size": 10}, "encoding": {"latitude": {"field": "latitude", "type": "quantitative"}, "longitude": {"field": "longitude", "type": "quantitative"}, "tooltip": [{"field": "tree_id", "title": "Tree ID", "type": "nominal"}]}}], "width": 450}, "columns": 2, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"mode": "vega-lite"});
</script></div></div>
<figcaption>
<p><span class="caption-number">Fig. 23 </span><span class="caption-text">Vancouver Street Trees by Neighbourhood</span><a class="headerlink" href="#neighbourhood-outlier-map" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Upon insection of <a class="reference internal" href="#neighbourhood-outlier-map"><span class="std std-numref">Fig. 23</span></a>, 28 trees are located outside their listed neighbourhood. We will drop these data points from our analysis.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neighbourhood_outlier_ids</span><span class="o">=</span><span class="p">[</span>
    <span class="mi">255981</span><span class="p">,</span><span class="mi">264928</span><span class="p">,</span><span class="mi">256165</span><span class="p">,</span> <span class="mi">255911</span><span class="p">,</span> <span class="c1"># Arbutus Ridge</span>
    <span class="mi">270750</span><span class="p">,</span> <span class="mi">59956</span><span class="p">,</span> <span class="c1"># Downtown</span>
    <span class="mi">256819</span><span class="p">,</span> <span class="mi">256822</span><span class="p">,</span> <span class="mi">256701</span><span class="p">,</span> <span class="mi">256717</span><span class="p">,</span> <span class="mi">256719</span><span class="p">,</span> <span class="mi">256890</span><span class="p">,</span> <span class="mi">256653</span><span class="p">,</span> <span class="mi">256706</span><span class="p">,</span> <span class="mi">256803</span><span class="p">,</span> <span class="mi">201285</span><span class="p">,</span> <span class="c1"># Dunbar-Southlands</span>
    <span class="mi">227312</span><span class="p">,</span> <span class="c1"># Grandview-Woodland</span>
    <span class="mi">256183</span><span class="p">,</span> <span class="mi">255969</span><span class="p">,</span> <span class="mi">256270</span><span class="p">,</span> <span class="c1"># Kitsilano</span>
    <span class="mi">141289</span><span class="p">,</span> <span class="c1"># Mount Pleasant</span>
    <span class="mi">256896</span><span class="p">,</span> <span class="mi">267123</span><span class="p">,</span> <span class="c1"># Renfrew-Collingwood</span>
    <span class="mi">263937</span><span class="p">,</span> <span class="c1"># South Cambie</span>
    <span class="mi">255068</span><span class="p">,</span> <span class="c1"># West End</span>
    <span class="mi">257203</span><span class="p">,</span> <span class="mi">256894</span><span class="p">,</span> <span class="mi">257095</span><span class="p">,</span> <span class="mi">257093</span> <span class="c1"># West Point Grey    </span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-cleansing">
<h2>Data Cleansing<a class="headerlink" href="#data-cleansing" title="Permalink to this headline">#</a></h2>
<p>Now, let’s create a base chart that filters out the previously identified outlier data from which we can build our final analysis charts.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_outliers</span> <span class="o">=</span> <span class="n">diameter_outlier_ids</span> <span class="o">+</span> <span class="n">neighbourhood_outlier_ids</span>

<span class="n">clean_trees</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">url_vancouver_trees</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;not&quot;</span><span class="p">:</span> <span class="n">alt</span><span class="o">.</span><span class="n">FieldOneOfPredicate</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s2">&quot;tree_id&quot;</span><span class="p">,</span> <span class="n">oneOf</span><span class="o">=</span><span class="n">all_outliers</span><span class="p">)}</span>
<span class="p">)</span>

<span class="c1"># Create clean trees descritive statistics table</span>
<span class="n">clean_trees_describe</span> <span class="o">=</span> <span class="n">trees_df</span><span class="p">[</span><span class="o">~</span><span class="n">trees_df</span><span class="p">[</span><span class="s1">&#39;tree_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">all_outliers</span><span class="p">)]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;clean_trees_describe&quot;</span><span class="p">,</span> <span class="n">clean_trees_describe</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Create ID count reference</span>
<span class="n">clean_id_count</span> <span class="o">=</span> <span class="n">clean_trees_describe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span><span class="s1">&#39;tree_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;clean_id_count&quot;</span><span class="p">,</span> <span class="n">clean_id_count</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-default" id="clean-trees-describe">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>diameter</th>
      <th>civic_number</th>
      <th>tree_id</th>
      <th>height_range_id</th>
      <th>on_street_block</th>
      <th>latitude</th>
      <th>longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>29957.000000</td>
      <td>29957.000000</td>
      <td>29957.000000</td>
      <td>29957.000000</td>
      <td>29957.000000</td>
      <td>29957.000000</td>
      <td>29957.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>12.179832</td>
      <td>2974.227893</td>
      <td>128143.781086</td>
      <td>2.718964</td>
      <td>2948.256601</td>
      <td>49.247565</td>
      <td>-123.106218</td>
    </tr>
    <tr>
      <th>std</th>
      <td>9.012142</td>
      <td>2068.728158</td>
      <td>75042.511379</td>
      <td>1.555135</td>
      <td>2070.323422</td>
      <td>0.021179</td>
      <td>0.049435</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.250000</td>
      <td>0.000000</td>
      <td>29.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>49.200732</td>
      <td>-123.223870</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.250000</td>
      <td>1319.000000</td>
      <td>62031.000000</td>
      <td>2.000000</td>
      <td>1300.000000</td>
      <td>49.230514</td>
      <td>-123.144617</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>10.000000</td>
      <td>2645.000000</td>
      <td>128992.000000</td>
      <td>2.000000</td>
      <td>2600.000000</td>
      <td>49.248194</td>
      <td>-123.104058</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>17.250000</td>
      <td>4063.000000</td>
      <td>190861.000000</td>
      <td>4.000000</td>
      <td>4100.000000</td>
      <td>49.263800</td>
      <td>-123.062798</td>
    </tr>
    <tr>
      <th>max</th>
      <td>72.000000</td>
      <td>9201.000000</td>
      <td>271025.000000</td>
      <td>10.000000</td>
      <td>9200.000000</td>
      <td>49.294528</td>
      <td>-123.023304</td>
    </tr>
  </tbody>
</table>
</div></div></div>
<figcaption>
<p><span class="caption-number">Fig. 24 </span><span class="caption-text">General statistics of <code class="docutils literal notranslate"><span class="pre">clean_trees</span></code> base chart data</span><a class="headerlink" href="#clean-trees-describe" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Upon inspection of <a class="reference internal" href="#clean-trees-describe"><span class="std std-numref">Fig. 24</span></a>, <span class="pasted-inline"><code class="output text_plain docutils literal notranslate"><span class="pre">29957</span></code></span> observations remain in cleansed data set, meaning only 0.14% of the observations were dropped for analysis. The maximum diameter of the trimmed data set is 72 inches while the minimum is now 0.25. These values are more reasonable. The mean diameter decreased by only 0.02 inches, from 12.20 inches to 12.18 inches. Removal of the outlier trees decreased the diameter range to a reasonable value while having little effect on the overall count of observations and mean of the diameter.</p>
</section>
<section id="id1">
<h2>Analysis<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h2>
<p>To begin our analysis, we will calculate our desired metrics within an Altair chart to use as a base for our final figures.</p>
<p>From <a class="reference internal" href="../docs/analysis_intro.html#importance-formulas"><span class="std std-ref">Equations</span></a> we will calculate the following:</p>
<ul class="simple">
<li><p>genus abundance using equation <a class="reference internal" href="../docs/analysis_intro.html#equation-relative-abundance-analysis">(6)</a></p></li>
<li><p>tree basal area using equation <a class="reference internal" href="../docs/analysis_intro.html#equation-basal-area-analysis">(7)</a></p></li>
<li><p>genus dominance using equation <a class="reference internal" href="../docs/analysis_intro.html#equation-relative-dominance-analysis">(8)</a></p></li>
<li><p>genus importance value using equation <a class="reference internal" href="../docs/analysis_intro.html#equation-importance-value-analysis">(9)</a></p></li>
<li><p>genus relative importance using equation <a class="reference internal" href="../docs/analysis_intro.html#equation-relative-importance-analysis">(10)</a>.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create chart with base calculations</span>
<span class="n">base_calc_chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">clean_trees</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>  <span class="c1"># Calculate basal area in m2</span>
        <span class="n">diameter_m</span><span class="o">=</span><span class="s2">&quot;datum.diameter*0.0254&quot;</span><span class="p">,</span> <span class="n">basal_area</span><span class="o">=</span><span class="s2">&quot;pow(datum.diameter_m/2,2)*PI&quot;</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_joinaggregate</span><span class="p">(</span>  <span class="c1"># Calculate total area and number of trees</span>
        <span class="n">total_basal_area</span><span class="o">=</span><span class="s2">&quot;sum(basal_area)&quot;</span><span class="p">,</span> <span class="n">total_count</span><span class="o">=</span><span class="s2">&quot;count(tree_id)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>  <span class="c1"># Calculate dominance, abundance, importance</span>
        <span class="n">relative_dominance</span><span class="o">=</span><span class="s2">&quot;datum.basal_area/datum.total_basal_area&quot;</span><span class="p">,</span>
        <span class="n">relative_abundance</span><span class="o">=</span><span class="s2">&quot;1/datum.total_count&quot;</span><span class="p">,</span>
        <span class="n">importance_value</span><span class="o">=</span><span class="s2">&quot;datum.relative_dominance + datum.relative_abundance&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="c1"># Calculate total importance value of population</span>
    <span class="o">.</span><span class="n">transform_joinaggregate</span><span class="p">(</span><span class="n">total_importance</span><span class="o">=</span><span class="s2">&quot;sum(importance_value)&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>  <span class="c1"># Calculate relative importance of each tree</span>
        <span class="n">relative_importance</span><span class="o">=</span><span class="s2">&quot;datum.importance_value/datum.total_importance&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="question-1">
<span id="question-1-a"></span><h3>Question 1:<a class="headerlink" href="#question-1" title="Permalink to this headline">#</a></h3>
<p><strong>How do the various genera in the Vancouver street tree population rank in relation to one another in terms of importance in the total population?</strong></p>
<aside class="margin sidebar">
<p class="sidebar-title">Did you know?</p>
<p>Trees belonging to the genus <i>Acer</i> are also known as Maple Trees!</p>
</aside>
<div class="cell tag_hide-input tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create genus multi select</span>
<span class="n">genus_click</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_multi</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus_name&quot;</span><span class="p">],</span>
    <span class="n">init</span><span class="o">=</span><span class="p">[</span> <span class="c1"># Initialize top 3 genera</span>
        <span class="p">{</span><span class="s2">&quot;genus_name&quot;</span><span class="p">:</span> <span class="s2">&quot;PRUNUS&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;genus_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ACER&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;genus_name&quot;</span><span class="p">:</span> <span class="s2">&quot;QUERCUS&quot;</span><span class="p">},</span>
    <span class="p">],</span>  
    <span class="n">empty</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create genus importance bar chart</span>
<span class="n">genus_importance_bar</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">base_calc_chart</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#54a24b&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_aggregate</span><span class="p">(</span>  <span class="c1"># Sum base calculations by genus, count individuals in each genus</span>
        <span class="n">total_relative_importance</span><span class="o">=</span><span class="s2">&quot;sum(relative_importance)&quot;</span><span class="p">,</span>
        <span class="n">total_relative_abundance</span><span class="o">=</span><span class="s2">&quot;sum(relative_abundance)&quot;</span><span class="p">,</span>
        <span class="n">total_relative_dominance</span><span class="o">=</span><span class="s2">&quot;sum(relative_dominance)&quot;</span><span class="p">,</span>
        <span class="n">total_basal_area</span><span class="o">=</span><span class="s2">&quot;sum(basal_area)&quot;</span><span class="p">,</span>
        <span class="n">genus_count</span><span class="o">=</span><span class="s2">&quot;count(tree_id)&quot;</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus_name&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>  <span class="c1"># Rank genera by importance in descending order</span>
        <span class="n">window</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="s2">&quot;as&quot;</span><span class="p">:</span> <span class="s2">&quot;importance_rank&quot;</span><span class="p">}],</span>
        <span class="n">sort</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;total_relative_importance&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="s2">&quot;descending&quot;</span><span class="p">}],</span>
    <span class="p">)</span>  <span class="c1"># Filter to include only top 10 genera</span>
    <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="s2">&quot;datum.importance_rank &lt;= 10&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>  <span class="c1"># encode genus vs importance</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
            <span class="s2">&quot;total_relative_importance:Q&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Relative importance&quot;</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span>
            <span class="s2">&quot;genus_name:N&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labelFontStyle</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">labelFontSize</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">&quot;genus_name:N&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Genus&quot;</span><span class="p">),</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span>
                <span class="s2">&quot;total_relative_importance:Q&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Relative importance&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2%&quot;</span>
            <span class="p">),</span>
        <span class="p">],</span>
        <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span> <span class="c1"># add selection indicator</span>
            <span class="n">genus_click</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="p">),</span>  
        <span class="n">strokeWidth</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Add text to bar chart</span>
<span class="n">genus_importance_bar_text</span> <span class="o">=</span> <span class="n">genus_importance_bar</span><span class="o">.</span><span class="n">mark_text</span><span class="p">(</span>
    <span class="n">dx</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span> <span class="n">fontStyle</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;total_relative_importance:Q&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2%&quot;</span><span class="p">),</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create dominance vs abundance scatter plot</span>
<span class="n">genus_abundance_dominance_scatter</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">genus_importance_bar</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#54a24b&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>  <span class="c1"># encode dominance vs abundance, format axes to %</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
            <span class="s2">&quot;total_relative_abundance:Q&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Relative abundance&quot;</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span>
            <span class="s2">&quot;total_relative_dominance:Q&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Relative dominance&quot;</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">size</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span>  <span class="c1"># encode genus importance as size</span>
            <span class="s2">&quot;total_relative_importance:Q&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Relative importance&quot;</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Legend</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;top-left&quot;</span><span class="p">),</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]),</span>
        <span class="p">),</span>
        <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span> <span class="c1"># Create selection indicator</span>
            <span class="n">genus_click</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="p">),</span>  
        <span class="n">strokeWidth</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span> <span class="c1"># decrease opacity of non-selected</span>
            <span class="n">genus_click</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s1">&#39;total_relative_abundance:Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Relative abundance&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;.2%&#39;</span><span class="p">),</span>
                 <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s1">&#39;total_relative_dominance:Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Relative dominance&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;.2%&#39;</span><span class="p">),</span>
                 <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s1">&#39;total_relative_importance:Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Relative importance&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;.2%&#39;</span><span class="p">)</span>
                <span class="p">]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Add text to scatter plot</span>
<span class="n">abundance_dominance_text</span> <span class="o">=</span> <span class="n">genus_abundance_dominance_scatter</span><span class="o">.</span><span class="n">mark_text</span><span class="p">(</span><span class="n">dy</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>  <span class="c1"># Show genus name of selected genera</span>
        <span class="n">genus_click</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;genus_name:N&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="p">),</span> 
    <span class="n">size</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
    <span class="n">strokeWidth</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Create mean basal area reference line</span>
<span class="n">mean_line</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;relative_dominance&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
    <span class="s2">&quot;relative_abundance&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">mean_line_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">mean_line</span><span class="p">)</span>
<span class="n">mean_line_chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">mean_line_df</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">strokeDash</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>  <span class="c1"># Create dashed line</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;relative_abundance:Q&quot;</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;relative_dominance:Q&quot;</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1"># Add reference line text</span>
<span class="n">mean_line_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mean_line_chart</span><span class="o">.</span><span class="n">mark_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">315</span><span class="p">,</span> <span class="n">dy</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Angle text to be parallel to line</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Mean basal area&quot;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="s2">&quot;datum.relative_dominance == 0.125&quot;</span><span class="p">)</span>  <span class="c1"># Restrict text to center</span>
<span class="p">)</span>

<span class="c1"># Create chart title</span>
<span class="n">genus_importance_title</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">TitleParams</span><span class="p">(</span>
    <span class="s2">&quot;Vancouver Street Tree Population Contains Two Co-Dominant Genera&quot;</span><span class="p">,</span>
    <span class="n">fontSize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">subtitle</span><span class="o">=</span><span class="s2">&quot;Genera Prunus and Acer both show an over 4-fold greater importance value than the next leading genus due to high abundance&quot;</span><span class="p">,</span>
    <span class="n">dy</span><span class="o">=-</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Combine charts, add selection, add title and configure concat chart</span>
<span class="n">tree_population_importance</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span>
        <span class="n">genus_abundance_dominance_scatter</span>
        <span class="o">+</span> <span class="n">abundance_dominance_text</span>
        <span class="o">+</span> <span class="n">mean_line_chart</span>
        <span class="o">+</span> <span class="n">mean_line_text</span>
    <span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">genus_click</span><span class="p">)</span>
    <span class="o">|</span> <span class="p">(</span><span class="n">genus_importance_bar</span> <span class="o">+</span> <span class="n">genus_importance_bar_text</span><span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">genus_click</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">configure_view</span><span class="p">(</span><span class="n">strokeWidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">genus_importance_title</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;tree_population_importance&quot;</span><span class="p">,</span><span class="n">tree_population_importance</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\danie\miniconda3\lib\site-packages\altair\utils\core.py:317: FutureWarning: iteritems is deprecated and will be removed in a future version. Use .items instead.
  for col_name, dtype in df.dtypes.iteritems():
</pre></div>
</div>
</div>
</div>
<figure class="align-default" id="tree-population-importance">
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-d45a9c1d866b489480a4caa733fc98de"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d45a9c1d866b489480a4caa733fc98de") {
      outputDiv = document.getElementById("altair-viz-d45a9c1d866b489480a4caa733fc98de");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300, "strokeWidth": 0}}, "hconcat": [{"layer": [{"mark": {"type": "circle", "color": "#54a24b"}, "encoding": {"opacity": {"condition": {"value": 1, "selection": "selector001"}, "value": 0.3}, "size": {"field": "total_relative_importance", "legend": {"format": "%", "orient": "top-left"}, "scale": {"domain": [0, 0.25]}, "title": "Relative importance", "type": "quantitative"}, "stroke": {"condition": {"value": "red", "selection": "selector001"}, "value": "black"}, "strokeWidth": {"value": 4}, "tooltip": [{"field": "total_relative_abundance", "format": ".2%", "title": "Relative abundance", "type": "quantitative"}, {"field": "total_relative_dominance", "format": ".2%", "title": "Relative dominance", "type": "quantitative"}, {"field": "total_relative_importance", "format": ".2%", "title": "Relative importance", "type": "quantitative"}], "x": {"axis": {"format": "%", "grid": false}, "field": "total_relative_abundance", "title": "Relative abundance", "type": "quantitative"}, "y": {"axis": {"format": "%", "grid": false}, "field": "total_relative_dominance", "title": "Relative dominance", "type": "quantitative"}}, "height": 300, "selection": {"selector001": {"type": "multi", "fields": ["genus_name"], "init": [{"genus_name": "PRUNUS"}, {"genus_name": "ACER"}, {"genus_name": "QUERCUS"}], "empty": "none"}}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"aggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}, {"op": "sum", "field": "relative_abundance", "as": "total_relative_abundance"}, {"op": "sum", "field": "relative_dominance", "as": "total_relative_dominance"}, {"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "genus_count"}], "groupby": ["genus_name"]}, {"window": [{"op": "rank", "as": "importance_rank"}], "sort": [{"field": "total_relative_importance", "order": "descending"}]}, {"filter": "datum.importance_rank <= 10"}], "width": 300}, {"mark": {"type": "text", "dy": 20}, "encoding": {"color": {"value": "black"}, "opacity": {"condition": {"value": 1, "selection": "selector001"}, "value": 0.3}, "size": {"value": 12}, "stroke": {"value": "black"}, "strokeWidth": {"value": 0.5}, "text": {"condition": {"field": "genus_name", "type": "nominal", "selection": "selector001"}, "value": ""}, "tooltip": [{"field": "total_relative_abundance", "format": ".2%", "title": "Relative abundance", "type": "quantitative"}, {"field": "total_relative_dominance", "format": ".2%", "title": "Relative dominance", "type": "quantitative"}, {"field": "total_relative_importance", "format": ".2%", "title": "Relative importance", "type": "quantitative"}], "x": {"axis": {"format": "%", "grid": false}, "field": "total_relative_abundance", "title": "Relative abundance", "type": "quantitative"}, "y": {"axis": {"format": "%", "grid": false}, "field": "total_relative_dominance", "title": "Relative dominance", "type": "quantitative"}}, "height": 300, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"aggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}, {"op": "sum", "field": "relative_abundance", "as": "total_relative_abundance"}, {"op": "sum", "field": "relative_dominance", "as": "total_relative_dominance"}, {"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "genus_count"}], "groupby": ["genus_name"]}, {"window": [{"op": "rank", "as": "importance_rank"}], "sort": [{"field": "total_relative_importance", "order": "descending"}]}, {"filter": "datum.importance_rank <= 10"}], "width": 300}, {"data": {"url": "http://localhost:63412/c6826870ea909cc17c6e97aac5d6aecc.json"}, "mark": {"type": "line", "color": "black", "strokeDash": [5, 5]}, "encoding": {"x": {"field": "relative_abundance", "type": "quantitative"}, "y": {"field": "relative_dominance", "type": "quantitative"}}}, {"data": {"url": "http://localhost:63412/c6826870ea909cc17c6e97aac5d6aecc.json"}, "mark": {"type": "text", "angle": 315, "dy": -10}, "encoding": {"text": {"value": "Mean basal area"}, "x": {"field": "relative_abundance", "type": "quantitative"}, "y": {"field": "relative_dominance", "type": "quantitative"}}, "transform": [{"filter": "datum.relative_dominance == 0.125"}]}]}, {"layer": [{"mark": {"type": "bar", "color": "#54a24b", "size": 20}, "encoding": {"stroke": {"condition": {"value": "red", "selection": "selector001"}, "value": "black"}, "strokeWidth": {"value": 4}, "tooltip": [{"field": "genus_name", "title": "Genus", "type": "nominal"}, {"field": "total_relative_importance", "format": ".2%", "title": "Relative importance", "type": "quantitative"}], "x": {"axis": {"grid": false, "labels": false, "ticks": false}, "field": "total_relative_importance", "title": "Relative importance", "type": "quantitative"}, "y": {"axis": {"labelFontSize": 12, "labelFontStyle": "bold"}, "field": "genus_name", "sort": "x", "title": null, "type": "nominal"}}, "height": 300, "selection": {"selector001": {"type": "multi", "fields": ["genus_name"], "init": [{"genus_name": "PRUNUS"}, {"genus_name": "ACER"}, {"genus_name": "QUERCUS"}], "empty": "none"}}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"aggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}, {"op": "sum", "field": "relative_abundance", "as": "total_relative_abundance"}, {"op": "sum", "field": "relative_dominance", "as": "total_relative_dominance"}, {"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "genus_count"}], "groupby": ["genus_name"]}, {"window": [{"op": "rank", "as": "importance_rank"}], "sort": [{"field": "total_relative_importance", "order": "descending"}]}, {"filter": "datum.importance_rank <= 10"}], "width": 400}, {"mark": {"type": "text", "baseline": "middle", "dx": 30, "fontStyle": "bold", "size": 12}, "encoding": {"stroke": {"condition": {"value": "red", "selection": "selector001"}, "value": "black"}, "strokeWidth": {"value": 0}, "text": {"field": "total_relative_importance", "format": ".2%", "type": "quantitative"}, "tooltip": [{"field": "genus_name", "title": "Genus", "type": "nominal"}, {"field": "total_relative_importance", "format": ".2%", "title": "Relative importance", "type": "quantitative"}], "x": {"axis": {"grid": false, "labels": false, "ticks": false}, "field": "total_relative_importance", "title": "Relative importance", "type": "quantitative"}, "y": {"axis": {"labelFontSize": 12, "labelFontStyle": "bold"}, "field": "genus_name", "sort": "x", "title": null, "type": "nominal"}}, "height": 300, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"aggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}, {"op": "sum", "field": "relative_abundance", "as": "total_relative_abundance"}, {"op": "sum", "field": "relative_dominance", "as": "total_relative_dominance"}, {"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "genus_count"}], "groupby": ["genus_name"]}, {"window": [{"op": "rank", "as": "importance_rank"}], "sort": [{"field": "total_relative_importance", "order": "descending"}]}, {"filter": "datum.importance_rank <= 10"}], "width": 400}]}], "data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/vancouver_trees.csv"}, "title": {"text": "Vancouver Street Tree Population Contains Two Co-Dominant Genera", "align": "left", "dx": 20, "dy": -20, "fontSize": 20, "subtitle": "Genera Prunus and Acer both show an over 4-fold greater importance value than the next leading genus due to high abundance"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"mode": "vega-lite"});
</script></div></div>
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">Top 10 Vancouver Street Tree Genera by Importance Value</span><a class="headerlink" href="#tree-population-importance" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Looking at the scatter plot of <a class="reference internal" href="#tree-population-importance"><span class="std std-numref">Fig. 25</span></a>, we can see that genera <i>Prunus</i> and <i>Acer</i> are significantly higher in relative abundance and relative dominance when compared to all other genera. Their proximity to the mean basal area line indicates that their high relative dominance is mainly due to their large quanity in the population and not due to a significantly higher mean diameter of trees within the the genus when compared to the total population.</p>
<p>Upon inspection of the bar chart in <a class="reference internal" href="#tree-population-importance"><span class="std std-numref">Fig. 25</span></a> we can see that genera <i>Prunus</i> and <i>Acer</i> are co-dominant genera within the Vancouver street tree population, differing by less than 1% in relative importance from each other, but are each over 4 times greater in importance than <i>Quercus</i>, the genera of the next highest importance value in the population.</p>
<p>Looking back at the scatter plot in <a class="reference internal" href="#tree-population-importance"><span class="std std-numref">Fig. 25</span></a>, we can see that although <i>Acer</i> has a higher relative abundance than <i>Prunus</i>, <i>Prunus’</i> relative dominance is higher than <i>Acer</i> due to a higher mean basal area. The higher mean basal area of <i>Prunus</i> is significant enough to raise its importance value beyond that of <i>Acer</i>. <i>Quercus</i> also has a higher mean basal area when compared to the total population, however, its low abundance decreases its importance to the overall population.</p>
<p>Let’s take a closer look at the various size classes of trees in these top 3 genera and examine how they contribute to the relative importance of each.</p>
</section>
<section id="question-2">
<span id="question-2-a"></span><h3>Question 2:<a class="headerlink" href="#question-2" title="Permalink to this headline">#</a></h3>
<p><strong>How do the different size classes of the top 3 genera contribute to each genus’ importance in the population, and is there a difference in this distribution between the genera?</strong></p>
<aside class="margin sidebar">
<p class="sidebar-title">Did you know?</p>
<p>Trees belonging to the genus <i>Prunus</i> are also known as Plum Trees!</p>
</aside>
<p>To perform this analysis, we will group trees into different size classes. We will bin the trees in 2 inch intervals as this is the standard way of classifying trees into size categories according to the US Department of Agriculture’s Forest Service Forest Inventory and Analysis glossary (“USDA Forest Service”).</p>
<p>We will normalize each distribution to the genus’ relative importance value to facilitate comparison between the genera.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_3_genus</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&quot;ACER&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;#88d27a&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;PRUNUS&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;#54a24b&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;QUERCUS&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;#f2cf5b&quot;</span><span class="p">}</span>

<span class="c1"># Create hover selection</span>
<span class="n">size_hover</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;diameter_m (binned)&quot;</span><span class="p">],</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;mouseover&quot;</span><span class="p">,</span> <span class="n">empty</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
<span class="p">)</span>


<span class="n">size_importance</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">base_calc_chart</span><span class="o">.</span><span class="n">transform_joinaggregate</span><span class="p">(</span>  <span class="c1"># Calculate % contribution of each tree to genus importance</span>
        <span class="n">total_relative_importance</span><span class="o">=</span><span class="s2">&quot;sum(relative_importance)&quot;</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus_name&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
        <span class="n">percent_of_importance</span><span class="o">=</span><span class="s2">&quot;datum.relative_importance / datum.total_relative_importance&quot;</span>
    <span class="p">)</span>  <span class="c1"># Bin trees in 5cm size classes</span>
    <span class="o">.</span><span class="n">transform_bin</span><span class="p">(</span>
        <span class="s2">&quot;diameter_m (binned)&quot;</span><span class="p">,</span> <span class="s2">&quot;diameter_m&quot;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span>
    <span class="p">)</span>  <span class="c1"># Encode % of genus importance vs binned diameter</span>
    <span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">strokeWidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
            <span class="s2">&quot;diameter_m (binned):Q&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]),</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">bandPosition</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Diameter (m)&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span>
            <span class="s2">&quot;sum(percent_of_importance):Q&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]),</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percent of genus importance&quot;</span><span class="p">,</span>
            <span class="n">stack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>  <span class="c1"># Add hover indicator</span>
        <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">size_hover</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)),</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">&quot;diameter_m (binned):Q&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Size class (m):&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2&quot;</span><span class="p">,)</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create blank v-concat chart</span>
<span class="n">histograms</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">VConcatChart</span><span class="p">()</span>

<span class="c1"># Create charts of top 3 genera through iteration of top 3 dictionary</span>
<span class="k">for</span> <span class="n">genus</span><span class="p">,</span> <span class="n">genus_color</span> <span class="ow">in</span> <span class="n">top_3_genus</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">new_histogram</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">size_importance</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">genus_color</span><span class="p">))</span>  <span class="c1"># add custom color</span>
        <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="s2">&quot;datum.genus_name ==&quot;</span> <span class="o">+</span> <span class="n">genus</span><span class="p">)</span>  <span class="c1"># Filter for genus</span>
        <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">genus</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">new_histogram_text</span> <span class="o">=</span> <span class="n">new_histogram</span><span class="o">.</span><span class="n">mark_text</span><span class="p">(</span><span class="n">dy</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>  <span class="c1"># Add % text</span>
        <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;sum(percent_of_importance):Q&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2%&quot;</span><span class="p">),</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
            <span class="n">size_hover</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">),</span>  <span class="c1"># Make text appear on hover</span>
        <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
    <span class="p">)</span>  <span class="c1"># Add new chart to concat chart</span>
    <span class="n">histograms</span> <span class="o">=</span> <span class="n">histograms</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="n">new_histogram</span> <span class="o">+</span> <span class="n">new_histogram_text</span>
    <span class="p">)</span>

    <span class="n">cumulative_size_importance</span> <span class="o">=</span> <span class="p">(</span>  <span class="c1"># Calculate running total of % importance</span>
    <span class="n">size_importance</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus_name&quot;</span><span class="p">],</span>
        <span class="n">sort</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;diameter_m (binned)&quot;</span><span class="p">}],</span>
        <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">cumulative_sum</span><span class="o">=</span><span class="s2">&quot;sum(percent_of_importance)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">mark_line</span><span class="p">()</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>  <span class="c1"># encode running % total vs diameter</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;diameter_m (binned):Q&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Diameter (m)&quot;</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span>
            <span class="s2">&quot;max(cumulative_sum):Q&quot;</span><span class="p">,</span>  <span class="c1"># Choose max because not aggregated</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cumulative percent of genus importance&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create blank layer charts</span>
<span class="n">cumulative_line</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">LayerChart</span><span class="p">()</span>
<span class="n">cumulative_point</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">LayerChart</span><span class="p">()</span>

<span class="c1"># Create line and point graphs by interating through top 3 dictionary</span>
<span class="k">for</span> <span class="n">genus</span><span class="p">,</span> <span class="n">genus_color</span> <span class="ow">in</span> <span class="n">top_3_genus</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">new_line</span> <span class="o">=</span> <span class="n">cumulative_size_importance</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">genus_color</span><span class="p">),</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Add custom colour</span>
    <span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span> <span class="c1"># Filter for genus</span>
        <span class="s2">&quot;datum.genus_name ==&quot;</span> <span class="o">+</span> <span class="n">genus</span>
    <span class="p">)</span>  
    <span class="n">new_point</span> <span class="o">=</span> <span class="n">new_line</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>  <span class="c1"># Show point on hover</span>
            <span class="n">size_hover</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">),</span> 
        <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">genus_color</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">new_point</span><span class="o">.</span><span class="n">mark_text</span><span class="p">(</span>
        <span class="n">dx</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">fontStyle</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>  <span class="c1"># Add cumulative % text</span>
        <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;max(cumulative_sum):Q&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2%&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
        <span class="n">strokeWidth</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="p">)</span>  <span class="c1"># Add to layer charts</span>
    <span class="n">cumulative_line</span> <span class="o">+=</span> <span class="n">new_line</span>
    <span class="n">cumulative_point</span> <span class="o">+=</span> <span class="n">new_point</span>
    <span class="n">cumulative_point</span> <span class="o">+=</span> <span class="n">new_text</span>

<span class="n">size_title</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">TitleParams</span><span class="p">(</span>
    <span class="s2">&quot;Relative importance value is differentially distributed among tree size classes between top 3 genera&quot;</span><span class="p">,</span>
    <span class="n">fontSize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
    <span class="n">subtitle</span><span class="o">=</span><span class="s2">&quot;Acer holds more importance in smaller diameter trees, Quercus in relatively larger diameter trees, while Prunus falls between them&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">importance_value_dist</span><span class="o">=</span> <span class="p">(</span>
    <span class="n">histograms</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">size_hover</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cumulative_line</span> <span class="o">+</span> <span class="n">cumulative_point</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">size_title</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;importance_value_dist&quot;</span><span class="p">,</span><span class="n">importance_value_dist</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-default" id="importance-value-dist">
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-a47127ee4142439aaa9b091c812bded2"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-a47127ee4142439aaa9b091c812bded2") {
      outputDiv = document.getElementById("altair-viz-a47127ee4142439aaa9b091c812bded2");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "hconcat": [{"vconcat": [{"layer": [{"mark": {"type": "bar", "size": 6, "strokeWidth": 2}, "encoding": {"color": {"value": "#88d27a"}, "stroke": {"condition": {"value": "red", "selection": "selector002"}, "value": "black"}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"axis": {"bandPosition": 0}, "field": "diameter_m (binned)", "scale": {"domain": [0.05, 1.5]}, "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "sum", "axis": {"format": "%"}, "field": "percent_of_importance", "scale": {"domain": [0, 0.15]}, "stack": false, "title": "Percent of genus importance", "type": "quantitative"}}, "height": 150, "selection": {"selector002": {"type": "single", "fields": ["diameter_m (binned)"], "on": "mouseover", "empty": "none"}}, "title": "\"ACER\"", "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"filter": "datum.genus_name ==\"ACER\""}], "width": 300}, {"mark": {"type": "text", "dy": -35, "size": 15}, "encoding": {"color": {"value": "black"}, "opacity": {"condition": {"value": 1, "selection": "selector002"}, "value": 0}, "stroke": {"value": "black"}, "text": {"aggregate": "sum", "field": "percent_of_importance", "format": ".2%", "type": "quantitative"}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"axis": {"bandPosition": 0}, "field": "diameter_m (binned)", "scale": {"domain": [0.05, 1.5]}, "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "sum", "axis": {"format": "%"}, "field": "percent_of_importance", "scale": {"domain": [0, 0.15]}, "stack": false, "title": "Percent of genus importance", "type": "quantitative"}}, "height": 150, "title": "\"ACER\"", "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"filter": "datum.genus_name ==\"ACER\""}], "width": 300}]}, {"layer": [{"mark": {"type": "bar", "size": 6, "strokeWidth": 2}, "encoding": {"color": {"value": "#54a24b"}, "stroke": {"condition": {"value": "red", "selection": "selector002"}, "value": "black"}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"axis": {"bandPosition": 0}, "field": "diameter_m (binned)", "scale": {"domain": [0.05, 1.5]}, "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "sum", "axis": {"format": "%"}, "field": "percent_of_importance", "scale": {"domain": [0, 0.15]}, "stack": false, "title": "Percent of genus importance", "type": "quantitative"}}, "height": 150, "selection": {"selector002": {"type": "single", "fields": ["diameter_m (binned)"], "on": "mouseover", "empty": "none"}}, "title": "\"PRUNUS\"", "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"filter": "datum.genus_name ==\"PRUNUS\""}], "width": 300}, {"mark": {"type": "text", "dy": -35, "size": 15}, "encoding": {"color": {"value": "black"}, "opacity": {"condition": {"value": 1, "selection": "selector002"}, "value": 0}, "stroke": {"value": "black"}, "text": {"aggregate": "sum", "field": "percent_of_importance", "format": ".2%", "type": "quantitative"}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"axis": {"bandPosition": 0}, "field": "diameter_m (binned)", "scale": {"domain": [0.05, 1.5]}, "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "sum", "axis": {"format": "%"}, "field": "percent_of_importance", "scale": {"domain": [0, 0.15]}, "stack": false, "title": "Percent of genus importance", "type": "quantitative"}}, "height": 150, "title": "\"PRUNUS\"", "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"filter": "datum.genus_name ==\"PRUNUS\""}], "width": 300}]}, {"layer": [{"mark": {"type": "bar", "size": 6, "strokeWidth": 2}, "encoding": {"color": {"value": "#f2cf5b"}, "stroke": {"condition": {"value": "red", "selection": "selector002"}, "value": "black"}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"axis": {"bandPosition": 0}, "field": "diameter_m (binned)", "scale": {"domain": [0.05, 1.5]}, "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "sum", "axis": {"format": "%"}, "field": "percent_of_importance", "scale": {"domain": [0, 0.15]}, "stack": false, "title": "Percent of genus importance", "type": "quantitative"}}, "height": 150, "selection": {"selector002": {"type": "single", "fields": ["diameter_m (binned)"], "on": "mouseover", "empty": "none"}}, "title": "\"QUERCUS\"", "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"filter": "datum.genus_name ==\"QUERCUS\""}], "width": 300}, {"mark": {"type": "text", "dy": -35, "size": 15}, "encoding": {"color": {"value": "black"}, "opacity": {"condition": {"value": 1, "selection": "selector002"}, "value": 0}, "stroke": {"value": "black"}, "text": {"aggregate": "sum", "field": "percent_of_importance", "format": ".2%", "type": "quantitative"}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"axis": {"bandPosition": 0}, "field": "diameter_m (binned)", "scale": {"domain": [0.05, 1.5]}, "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "sum", "axis": {"format": "%"}, "field": "percent_of_importance", "scale": {"domain": [0, 0.15]}, "stack": false, "title": "Percent of genus importance", "type": "quantitative"}}, "height": 150, "title": "\"QUERCUS\"", "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"filter": "datum.genus_name ==\"QUERCUS\""}], "width": 300}]}]}, {"layer": [{"mark": "line", "encoding": {"stroke": {"value": "#88d27a"}, "strokeWidth": {"value": 4}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"field": "diameter_m (binned)", "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "max", "axis": {"format": "%"}, "field": "cumulative_sum", "scale": {"domain": [0, 1]}, "title": "Cumulative percent of genus importance", "type": "quantitative"}}, "height": 600, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"window": [{"op": "sum", "field": "percent_of_importance", "as": "cumulative_sum"}], "frame": [null, 0], "groupby": ["genus_name"], "sort": [{"field": "diameter_m (binned)"}]}, {"filter": "datum.genus_name ==\"ACER\""}], "width": 450}, {"mark": "line", "encoding": {"stroke": {"value": "#54a24b"}, "strokeWidth": {"value": 4}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"field": "diameter_m (binned)", "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "max", "axis": {"format": "%"}, "field": "cumulative_sum", "scale": {"domain": [0, 1]}, "title": "Cumulative percent of genus importance", "type": "quantitative"}}, "height": 600, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"window": [{"op": "sum", "field": "percent_of_importance", "as": "cumulative_sum"}], "frame": [null, 0], "groupby": ["genus_name"], "sort": [{"field": "diameter_m (binned)"}]}, {"filter": "datum.genus_name ==\"PRUNUS\""}], "width": 450}, {"mark": "line", "encoding": {"stroke": {"value": "#f2cf5b"}, "strokeWidth": {"value": 4}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"field": "diameter_m (binned)", "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "max", "axis": {"format": "%"}, "field": "cumulative_sum", "scale": {"domain": [0, 1]}, "title": "Cumulative percent of genus importance", "type": "quantitative"}}, "height": 600, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"window": [{"op": "sum", "field": "percent_of_importance", "as": "cumulative_sum"}], "frame": [null, 0], "groupby": ["genus_name"], "sort": [{"field": "diameter_m (binned)"}]}, {"filter": "datum.genus_name ==\"QUERCUS\""}], "width": 450}, {"layer": [{"mark": {"type": "circle", "size": 100}, "encoding": {"color": {"value": "#88d27a"}, "opacity": {"condition": {"value": 1, "selection": "selector002"}, "value": 0}, "stroke": {"value": "black"}, "strokeWidth": {"value": 4}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"field": "diameter_m (binned)", "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "max", "axis": {"format": "%"}, "field": "cumulative_sum", "scale": {"domain": [0, 1]}, "title": "Cumulative percent of genus importance", "type": "quantitative"}}, "height": 600, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"window": [{"op": "sum", "field": "percent_of_importance", "as": "cumulative_sum"}], "frame": [null, 0], "groupby": ["genus_name"], "sort": [{"field": "diameter_m (binned)"}]}, {"filter": "datum.genus_name ==\"ACER\""}], "width": 450}, {"mark": {"type": "text", "dx": 35, "fontStyle": "bold", "size": 15}, "encoding": {"color": {"value": "black"}, "opacity": {"condition": {"value": 1, "selection": "selector002"}, "value": 0}, "stroke": {"value": "black"}, "strokeWidth": {"value": 0}, "text": {"aggregate": "max", "field": "cumulative_sum", "format": ".2%", "type": "quantitative"}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"field": "diameter_m (binned)", "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "max", "axis": {"format": "%"}, "field": "cumulative_sum", "scale": {"domain": [0, 1]}, "title": "Cumulative percent of genus importance", "type": "quantitative"}}, "height": 600, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"window": [{"op": "sum", "field": "percent_of_importance", "as": "cumulative_sum"}], "frame": [null, 0], "groupby": ["genus_name"], "sort": [{"field": "diameter_m (binned)"}]}, {"filter": "datum.genus_name ==\"ACER\""}], "width": 450}, {"mark": {"type": "circle", "size": 100}, "encoding": {"color": {"value": "#54a24b"}, "opacity": {"condition": {"value": 1, "selection": "selector002"}, "value": 0}, "stroke": {"value": "black"}, "strokeWidth": {"value": 4}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"field": "diameter_m (binned)", "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "max", "axis": {"format": "%"}, "field": "cumulative_sum", "scale": {"domain": [0, 1]}, "title": "Cumulative percent of genus importance", "type": "quantitative"}}, "height": 600, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"window": [{"op": "sum", "field": "percent_of_importance", "as": "cumulative_sum"}], "frame": [null, 0], "groupby": ["genus_name"], "sort": [{"field": "diameter_m (binned)"}]}, {"filter": "datum.genus_name ==\"PRUNUS\""}], "width": 450}, {"mark": {"type": "text", "dx": 35, "fontStyle": "bold", "size": 15}, "encoding": {"color": {"value": "black"}, "opacity": {"condition": {"value": 1, "selection": "selector002"}, "value": 0}, "stroke": {"value": "black"}, "strokeWidth": {"value": 0}, "text": {"aggregate": "max", "field": "cumulative_sum", "format": ".2%", "type": "quantitative"}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"field": "diameter_m (binned)", "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "max", "axis": {"format": "%"}, "field": "cumulative_sum", "scale": {"domain": [0, 1]}, "title": "Cumulative percent of genus importance", "type": "quantitative"}}, "height": 600, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"window": [{"op": "sum", "field": "percent_of_importance", "as": "cumulative_sum"}], "frame": [null, 0], "groupby": ["genus_name"], "sort": [{"field": "diameter_m (binned)"}]}, {"filter": "datum.genus_name ==\"PRUNUS\""}], "width": 450}, {"mark": {"type": "circle", "size": 100}, "encoding": {"color": {"value": "#f2cf5b"}, "opacity": {"condition": {"value": 1, "selection": "selector002"}, "value": 0}, "stroke": {"value": "black"}, "strokeWidth": {"value": 4}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"field": "diameter_m (binned)", "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "max", "axis": {"format": "%"}, "field": "cumulative_sum", "scale": {"domain": [0, 1]}, "title": "Cumulative percent of genus importance", "type": "quantitative"}}, "height": 600, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"window": [{"op": "sum", "field": "percent_of_importance", "as": "cumulative_sum"}], "frame": [null, 0], "groupby": ["genus_name"], "sort": [{"field": "diameter_m (binned)"}]}, {"filter": "datum.genus_name ==\"QUERCUS\""}], "width": 450}, {"mark": {"type": "text", "dx": 35, "fontStyle": "bold", "size": 15}, "encoding": {"color": {"value": "black"}, "opacity": {"condition": {"value": 1, "selection": "selector002"}, "value": 0}, "stroke": {"value": "black"}, "strokeWidth": {"value": 0}, "text": {"aggregate": "max", "field": "cumulative_sum", "format": ".2%", "type": "quantitative"}, "tooltip": [{"field": "diameter_m (binned)", "format": ".2", "title": "Size class (m):", "type": "quantitative"}], "x": {"field": "diameter_m (binned)", "title": "Diameter (m)", "type": "quantitative"}, "y": {"aggregate": "max", "axis": {"format": "%"}, "field": "cumulative_sum", "scale": {"domain": [0, 1]}, "title": "Cumulative percent of genus importance", "type": "quantitative"}}, "height": 600, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"calculate": "datum.relative_importance / datum.total_relative_importance", "as": "percent_of_importance"}, {"bin": {"step": 0.05}, "field": "diameter_m", "as": "diameter_m (binned)"}, {"window": [{"op": "sum", "field": "percent_of_importance", "as": "cumulative_sum"}], "frame": [null, 0], "groupby": ["genus_name"], "sort": [{"field": "diameter_m (binned)"}]}, {"filter": "datum.genus_name ==\"QUERCUS\""}], "width": 450}]}]}], "data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/vancouver_trees.csv"}, "title": {"text": "Relative importance value is differentially distributed among tree size classes between top 3 genera", "fontSize": 18, "subtitle": "Acer holds more importance in smaller diameter trees, Quercus in relatively larger diameter trees, while Prunus falls between them"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"mode": "vega-lite"});
</script></div></div>
<figcaption>
<p><span class="caption-number">Fig. 26 </span><span class="caption-text">Distribution of Importance Value by Size of the Top 3 Genera by Importance</span><a class="headerlink" href="#importance-value-dist" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Looking at the importance distributions in <a class="reference internal" href="#importance-value-dist"><span class="std std-numref">Fig. 26</span></a>, we can see that the top 3 genera have a similar range of size classes, however, the total importance value for each genus is distributed differently between them.</p>
<p>The importance value of <i>Acer</i> is held in relatively smaller size classes in comparison to both <i>Prunus</i> and <i>Quercus</i>, showing a right-skewed importance distribution. The line chart of <a class="reference internal" href="#importance-value-dist"><span class="std std-numref">Fig. 26</span></a> shows that <i>Acer</i> has the steepest cumulative importance vs diameter slope, with 50% of the genus’ importance being held in size classes 0.35m and below, the most being held in the 0.05m class as seen in the <i>Acer</i> distribution of importance of figure 2a.</p>
<p>The importance value of <i>Prunus</i> is held in relatively larger size classes than <i>Acer</i> but smaller than <i>Quercus</i>. The importance distribution of <i>Prunus</i> shown in <a class="reference internal" href="#importance-value-dist"><span class="std std-numref">Fig. 26</span></a> shows a slighly right-skewed distribution, but less extreme than that of <i>Acer</i>.This corresponds to the line chart of <a class="reference internal" href="#importance-value-dist"><span class="std std-numref">Fig. 26</span></a> where <i>Prunus</i> shows a less extreme initial slope between the 0m and 0.2m size classes when compared to <i>Acer</i>. The slope increases significantly between 0.2m and 0.6m, catching up and nearly matching <i>Acer</i> from 0.6m on. 50% of the importance value of <i>Prunus</i> is held in size classes 0.45m and below, the most importance being held in the 0.45m size class, at 9.32%.</p>
<p>The importance value of <i>Quercus</i> shows a more even distribution between size classes in comparison to both <i>Prunus</i> and <i>Acer</i> as seen upon inspection of the <i>Quercus</i> importance distribution in figure <a class="reference internal" href="#importance-value-dist"><span class="std std-numref">Fig. 26</span></a>. The line chart of <a class="reference internal" href="#importance-value-dist"><span class="std std-numref">Fig. 26</span></a> shows that <i>Quercus</i> has the shallowest cumulative importance vs diameter slope of all 3 genera, with 50% of <i>Quercus’s</i> importance value being held in size classes 0.6m and below. The 0.6m size class holds the most importance for the <i>Quercus</i> genus at 7.12% of <i>Quercus’</i> total importance.</p>
</section>
<section id="question-3">
<span id="question-3-a"></span><h3>Question 3:<a class="headerlink" href="#question-3" title="Permalink to this headline">#</a></h3>
<p><strong>How do Vancouver neighbourhoods compare in terms of importance value density of the street tree population?</strong></p>
<aside class="margin sidebar">
<p class="sidebar-title">Did you know?</p>
<p>Trees belonging to the genus <i>Quercus</i> are also known as Oak trees!</p>
</aside>
<p>To perform this analysis, we will group trees by the neighbourhood in which they are located instead of by genus, and normalize the values to the neighbourhood’s total land area to obtain an importance density for the neighbourhood. As we are normalizing to the land area of each neighbourhood, we will using total importance value in our calculation as opposed to relative importance value.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create hover indicator</span>
<span class="n">neighbourhood_hover</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">],</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;mouseover&quot;</span><span class="p">,</span> <span class="n">empty</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
<span class="p">)</span>

<span class="c1"># Create base map with calculations</span>
<span class="n">neighbourhood_importance_map_base</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">base_calc_chart</span><span class="o">.</span><span class="n">transform_lookup</span><span class="p">(</span>  <span class="c1"># Lookup neighbourhood data from geojson</span>
        <span class="n">lookup</span><span class="o">=</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">,</span>
        <span class="n">from_</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">LookupData</span><span class="p">(</span><span class="n">data_geojson_remote</span><span class="p">,</span> <span class="s2">&quot;properties.name&quot;</span><span class="p">),</span>
        <span class="n">as_</span><span class="o">=</span><span class="s2">&quot;geom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_aggregate</span><span class="p">(</span>  <span class="c1"># Find total importance of neighbourhood, median latitude and longitude</span>
        <span class="n">neighbourhood_importance</span><span class="o">=</span><span class="s2">&quot;sum(importance_value)&quot;</span><span class="p">,</span>
        <span class="n">median_longitude</span><span class="o">=</span><span class="s2">&quot;median(longitude):Q&quot;</span><span class="p">,</span>
        <span class="n">median_latitude</span><span class="o">=</span><span class="s2">&quot;median(latitude):Q&quot;</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">,</span> <span class="s2">&quot;geom&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_lookup</span><span class="p">(</span>  <span class="c1"># Lookup land area of neighbourhood</span>
        <span class="n">lookup</span><span class="o">=</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">,</span>
        <span class="n">from_</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">LookupData</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">url_neighbourhood_demographics</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;land_area&quot;</span><span class="p">],</span>
        <span class="p">),</span>
        <span class="n">as_</span><span class="o">=</span><span class="s2">&quot;land_area_ha&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>  <span class="c1"># Extract geometry and type from geojson</span>
        <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;datum.geom.geometry&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;datum.geom.type&quot;</span><span class="p">,</span>
        <span class="n">text_x</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>  <span class="c1"># X value for neighbourhood list</span>
        <span class="n">land_area_km2</span><span class="o">=</span><span class="s2">&quot;datum.land_area_ha/100&quot;</span><span class="p">,</span>  <span class="c1"># Convert to Km2</span>
        <span class="n">importance_per_km2</span><span class="o">=</span><span class="s2">&quot;(datum.neighbourhood_importance/datum.land_area_km2)*100&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>  <span class="c1"># Rank neighbourhood by importance</span>
        <span class="n">window</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="s2">&quot;as&quot;</span><span class="p">:</span> <span class="s2">&quot;importance_rank&quot;</span><span class="p">}],</span>
        <span class="n">sort</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;importance_per_km2&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="s2">&quot;descending&quot;</span><span class="p">}],</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create neighbourhood chloropleth map</span>
<span class="n">neighbourhood_importance_map</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">neighbourhood_importance_map_base</span><span class="o">.</span><span class="n">mark_geoshape</span><span class="p">(</span><span class="n">stroke</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>  <span class="c1"># Encode importance per Km2 in color channel</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span>
            <span class="s2">&quot;importance_per_km2:Q&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;yellowgreen&quot;</span><span class="p">),</span>
            <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Legend</span><span class="p">(</span>
                <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2&quot;</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;top-left&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neighbourhood importance per Km2&quot;</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">&quot;neighbourhood_name:N&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neighbourhood&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">reflectY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create neighbourhood hover overlay</span>
<span class="n">neighbourhood_importance_map_overlay</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">neighbourhood_importance_map_base</span><span class="o">.</span><span class="n">mark_geoshape</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
            <span class="n">neighbourhood_hover</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="p">),</span>  <span class="c1"># Red border on hover</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
            <span class="n">neighbourhood_hover</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">),</span>  <span class="c1"># Opacity of 0 when not hovering</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">reflectY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Add text to neighbourhood chloropleth map</span>
<span class="n">neighbourhood_importance_text</span> <span class="o">=</span> <span class="n">neighbourhood_importance_map_base</span><span class="o">.</span><span class="n">mark_text</span><span class="p">(</span>
    <span class="n">fontStyle</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">fontSize</span><span class="o">=</span><span class="mi">15</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">latitude</span><span class="o">=</span><span class="s2">&quot;median_latitude:Q&quot;</span><span class="p">,</span>
    <span class="n">longitude</span><span class="o">=</span><span class="s2">&quot;median_longitude:Q&quot;</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;importance_per_km2:Q&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Create title for neighbourhood list</span>
<span class="n">neighbourhood_rank_text_title</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">TitleParams</span><span class="p">(</span>
    <span class="s2">&quot;Neighbourhood&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">fontSize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontStyle</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span>
<span class="p">)</span>

<span class="c1"># Create neighbourhood list</span>
<span class="n">neighbourhood_rank_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">neighbourhood_importance_map_base</span><span class="o">.</span><span class="n">mark_text</span><span class="p">(</span>
        <span class="n">fontStyle</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">fontSize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;importance_rank:O&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>  <span class="c1"># Order by importance rank</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;text_x:Q&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="mi">5</span><span class="p">)),</span>
        <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;neighbourhood_name:N&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
            <span class="n">neighbourhood_hover</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="p">),</span>  <span class="c1"># Highlight in red on hover</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">neighbourhood_rank_text_title</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create chart title</span>
<span class="n">neighbourhood_importance_title</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">TitleParams</span><span class="p">(</span>
    <span class="s2">&quot;Vancouver neighbourhoods differ in density of street tree importance&quot;</span><span class="p">,</span>
    <span class="n">subtitle</span><span class="o">=</span><span class="s2">&quot;Kitsilano holds the most importance value per square kilometer, while Strathcona holds the least&quot;</span><span class="p">,</span>
    <span class="n">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="n">fontSize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create layered map and horizonatally concatenate with rank text</span>
<span class="n">neighbourhood_importance_density</span><span class="o">=</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="n">neighbourhood_importance_map</span>
        <span class="o">+</span> <span class="n">neighbourhood_importance_text</span>
        <span class="o">+</span> <span class="n">neighbourhood_importance_map_overlay</span>
    <span class="p">)</span>
    <span class="o">|</span> <span class="n">neighbourhood_rank_text</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">neighbourhood_hover</span><span class="p">)</span><span class="o">.</span><span class="n">configure_view</span><span class="p">(</span><span class="n">strokeWidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="n">neighbourhood_importance_title</span>
<span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;neighbourhood_importance_density&quot;</span><span class="p">,</span> <span class="n">neighbourhood_importance_density</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-default" id="neighbourhood-importance-density">
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-64797f9e6ca84eb1a23d427edde61417"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-64797f9e6ca84eb1a23d427edde61417") {
      outputDiv = document.getElementById("altair-viz-64797f9e6ca84eb1a23d427edde61417");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300, "strokeWidth": 0}}, "hconcat": [{"layer": [{"mark": {"type": "geoshape", "stroke": "black", "strokeWidth": 4}, "encoding": {"color": {"field": "importance_per_km2", "legend": {"format": ".2", "orient": "top-left", "title": "Neighbourhood importance per Km2"}, "scale": {"scheme": "yellowgreen"}, "type": "quantitative"}, "tooltip": {"field": "neighbourhood_name", "title": "Neighbourhood", "type": "nominal"}}, "height": 450, "projection": {"reflectY": true, "type": "identity"}, "selection": {"selector003": {"type": "single", "fields": ["neighbourhood_name"], "on": "mouseover", "empty": "none"}}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"lookup": "neighbourhood_name", "as": "geom", "from": {"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson", "format": {"property": "features", "type": "json"}}, "key": "properties.name"}}, {"aggregate": [{"op": "sum", "field": "importance_value", "as": "neighbourhood_importance"}, {"op": "median", "field": "longitude", "as": "median_longitude"}, {"op": "median", "field": "latitude", "as": "median_latitude"}], "groupby": ["neighbourhood_name", "geom"]}, {"lookup": "neighbourhood_name", "as": "land_area_ha", "from": {"data": {"url": "https://raw.githubusercontent.com/Daniel-J-Stevens/data-science-toolbox_assignment-8/main/van-trees_book/data/neighbourhood_demographics.csv"}, "key": "neighbourhood_name", "fields": ["land_area"]}}, {"calculate": "datum.geom.geometry", "as": "geometry"}, {"calculate": "datum.geom.type", "as": "type"}, {"calculate": "0", "as": "text_x"}, {"calculate": "datum.land_area_ha/100", "as": "land_area_km2"}, {"calculate": "(datum.neighbourhood_importance/datum.land_area_km2)*100", "as": "importance_per_km2"}, {"window": [{"op": "rank", "as": "importance_rank"}], "sort": [{"field": "importance_per_km2", "order": "descending"}]}], "width": 700}, {"mark": {"type": "text", "fontSize": 15, "fontStyle": "bold"}, "encoding": {"latitude": {"field": "median_latitude", "type": "quantitative"}, "longitude": {"field": "median_longitude", "type": "quantitative"}, "text": {"field": "importance_per_km2", "format": ".2", "type": "quantitative"}}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"lookup": "neighbourhood_name", "as": "geom", "from": {"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson", "format": {"property": "features", "type": "json"}}, "key": "properties.name"}}, {"aggregate": [{"op": "sum", "field": "importance_value", "as": "neighbourhood_importance"}, {"op": "median", "field": "longitude", "as": "median_longitude"}, {"op": "median", "field": "latitude", "as": "median_latitude"}], "groupby": ["neighbourhood_name", "geom"]}, {"lookup": "neighbourhood_name", "as": "land_area_ha", "from": {"data": {"url": "https://raw.githubusercontent.com/Daniel-J-Stevens/data-science-toolbox_assignment-8/main/van-trees_book/data/neighbourhood_demographics.csv"}, "key": "neighbourhood_name", "fields": ["land_area"]}}, {"calculate": "datum.geom.geometry", "as": "geometry"}, {"calculate": "datum.geom.type", "as": "type"}, {"calculate": "0", "as": "text_x"}, {"calculate": "datum.land_area_ha/100", "as": "land_area_km2"}, {"calculate": "(datum.neighbourhood_importance/datum.land_area_km2)*100", "as": "importance_per_km2"}, {"window": [{"op": "rank", "as": "importance_rank"}], "sort": [{"field": "importance_per_km2", "order": "descending"}]}]}, {"mark": {"type": "geoshape", "fill": null, "strokeWidth": 4}, "encoding": {"opacity": {"condition": {"value": 1, "selection": "selector003"}, "value": 0}, "stroke": {"condition": {"value": "red", "selection": "selector003"}, "value": "black"}}, "projection": {"reflectY": true, "type": "identity"}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"lookup": "neighbourhood_name", "as": "geom", "from": {"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson", "format": {"property": "features", "type": "json"}}, "key": "properties.name"}}, {"aggregate": [{"op": "sum", "field": "importance_value", "as": "neighbourhood_importance"}, {"op": "median", "field": "longitude", "as": "median_longitude"}, {"op": "median", "field": "latitude", "as": "median_latitude"}], "groupby": ["neighbourhood_name", "geom"]}, {"lookup": "neighbourhood_name", "as": "land_area_ha", "from": {"data": {"url": "https://raw.githubusercontent.com/Daniel-J-Stevens/data-science-toolbox_assignment-8/main/van-trees_book/data/neighbourhood_demographics.csv"}, "key": "neighbourhood_name", "fields": ["land_area"]}}, {"calculate": "datum.geom.geometry", "as": "geometry"}, {"calculate": "datum.geom.type", "as": "type"}, {"calculate": "0", "as": "text_x"}, {"calculate": "datum.land_area_ha/100", "as": "land_area_km2"}, {"calculate": "(datum.neighbourhood_importance/datum.land_area_km2)*100", "as": "importance_per_km2"}, {"window": [{"op": "rank", "as": "importance_rank"}], "sort": [{"field": "importance_per_km2", "order": "descending"}]}]}]}, {"mark": {"type": "text", "align": "left", "fontSize": 15, "fontStyle": "bold"}, "encoding": {"color": {"condition": {"value": "red", "selection": "selector003"}, "value": "black"}, "text": {"field": "neighbourhood_name", "type": "nominal"}, "x": {"axis": null, "field": "text_x", "scale": {"padding": 5}, "type": "quantitative"}, "y": {"axis": null, "field": "importance_rank", "type": "ordinal"}}, "height": 450, "selection": {"selector003": {"type": "single", "fields": ["neighbourhood_name"], "on": "mouseover", "empty": "none"}}, "title": {"text": "Neighbourhood", "align": "left", "fontSize": 20, "fontStyle": "bold"}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"lookup": "neighbourhood_name", "as": "geom", "from": {"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson", "format": {"property": "features", "type": "json"}}, "key": "properties.name"}}, {"aggregate": [{"op": "sum", "field": "importance_value", "as": "neighbourhood_importance"}, {"op": "median", "field": "longitude", "as": "median_longitude"}, {"op": "median", "field": "latitude", "as": "median_latitude"}], "groupby": ["neighbourhood_name", "geom"]}, {"lookup": "neighbourhood_name", "as": "land_area_ha", "from": {"data": {"url": "https://raw.githubusercontent.com/Daniel-J-Stevens/data-science-toolbox_assignment-8/main/van-trees_book/data/neighbourhood_demographics.csv"}, "key": "neighbourhood_name", "fields": ["land_area"]}}, {"calculate": "datum.geom.geometry", "as": "geometry"}, {"calculate": "datum.geom.type", "as": "type"}, {"calculate": "0", "as": "text_x"}, {"calculate": "datum.land_area_ha/100", "as": "land_area_km2"}, {"calculate": "(datum.neighbourhood_importance/datum.land_area_km2)*100", "as": "importance_per_km2"}, {"window": [{"op": "rank", "as": "importance_rank"}], "sort": [{"field": "importance_per_km2", "order": "descending"}]}], "width": 50}], "data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/vancouver_trees.csv"}, "title": {"text": "Vancouver neighbourhoods differ in density of street tree importance", "align": "left", "fontSize": 20, "subtitle": "Kitsilano holds the most importance value per square kilometer, while Strathcona holds the least"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"mode": "vega-lite"});
</script></div></div>
<figcaption>
<p><span class="caption-number">Fig. 27 </span><span class="caption-text">Importance density by neighbourhood</span><a class="headerlink" href="#neighbourhood-importance-density" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Upon inspection of <a class="reference internal" href="#neighbourhood-importance-density"><span class="std std-numref">Fig. 27</span></a>, we can see that the density of street tree importance differs between Vancouver neighbourhoods.</p>
<p>The neighbourhood of Kitsilano shows the highest importance value density, with a value of 2.5 / Km<sup>2</sup>, followed closely by the West End at 2.4 / Km<sup>2</sup> and Shaughnessy at 2.4 / Km<sup>2</sup>. These neighbourhoods are all contained in the north-western quadrant of the Vancouver area, the West End and Shaughnessy both being neighbourhoods adjacent to Kitsilano.</p>
<p>The neighbourhood of Strathcona shows the lowest importance value density of street trees at 0.71 / Km<sup>2</sup>. This is significantly lower than all other neighbourhoods, the closest neighbourhood in terms of importance value density being Kilarney at 1.1 / Km<sup>2</sup>. The surrounding neighbourhoods of Grandview-Woodland and Mount Pleasant show importance value densities of 1.9 / Km<sup>2</sup> and 2.1 / Km<sup>2</sup> respectively, significantly higher than that of Strathcona, while the remaining adjacent neighbourhood of Downtown also shows a higher importance value density of 1.1 / Km<sup>2</sup>, but less markedly so.</p>
</section>
<section id="question-4">
<span id="question-4-a"></span><h3>Question 4:<a class="headerlink" href="#question-4" title="Permalink to this headline">#</a></h3>
<p><strong>Dashboard: How is the relative importance value of the various street tree genera distributed throughout Vancouver?</strong></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Use the interactive dashboard below to explore the distribution of street tree genera throughout Vancouver.</p>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create selections</span>

<span class="c1"># Neighbourhood &amp; Genus selectors</span>
<span class="n">neighbourhood_genus_filter</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_multi</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">,</span> <span class="s2">&quot;genus_name&quot;</span><span class="p">],</span>
    <span class="n">empty</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">init</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Kensington-Cedar Cottage&quot;</span><span class="p">,</span> <span class="s2">&quot;genus_name&quot;</span><span class="p">:</span> <span class="s2">&quot;PRUNUS&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Kensington-Cedar Cottage&quot;</span><span class="p">,</span> <span class="s2">&quot;genus_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ACER&quot;</span><span class="p">},</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">neighbourhood_genus_hover</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">,</span> <span class="s2">&quot;genus_name&quot;</span><span class="p">],</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;mouseover&quot;</span><span class="p">,</span> <span class="n">empty</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
<span class="p">)</span>


<span class="c1"># Create widgets and bind to selectors</span>

<span class="c1"># Rank slider</span>
<span class="n">rank_slider</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Genus importance rank:&quot;</span><span class="p">)</span>

<span class="n">select_rank</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus_rank&quot;</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="n">rank_slider</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;genus_rank&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Genus dropdown</span>
<span class="n">genus_name</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="s2">&quot;https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/vancouver_trees.csv&quot;</span><span class="p">,</span>
        <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus_name&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;genus_name&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;genus_name&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">genus_dropdown</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_select</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">genus_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Genus selection:&quot;</span><span class="p">)</span>

<span class="n">select_genus</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus_name&quot;</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="n">genus_dropdown</span><span class="p">)</span>


<span class="c1"># Create genus importance by neighbourhood heat map</span>
<span class="n">heat_map_title</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">TitleParams</span><span class="p">(</span>
    <span class="s2">&quot;Genus importance distribution by neighbourhood&quot;</span><span class="p">,</span> <span class="n">fontSize</span><span class="o">=</span><span class="mi">15</span>
<span class="p">)</span>
<span class="n">importance_heat_map</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">base_calc_chart</span><span class="o">.</span><span class="n">mark_rect</span><span class="p">(</span><span class="n">stroke</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;neighbourhood_name:N&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neighbourhood&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;-color&quot;</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;genus_name:N&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Genus&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span>
            <span class="s2">&quot;sum(relative_importance):Q&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;yellowgreen&quot;</span><span class="p">),</span>
            <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Relative importance&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span>
                <span class="s2">&quot;sum(relative_importance):Q&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2%&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Relative importance&quot;</span>
            <span class="p">),</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">&quot;neighbourhood_name:N&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neighbourhood&quot;</span><span class="p">),</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">&quot;genus_name:N&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Genus&quot;</span><span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_joinaggregate</span><span class="p">(</span>
        <span class="n">total_relative_importance</span><span class="o">=</span><span class="s2">&quot;sum(relative_importance)&quot;</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus_name&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
        <span class="n">window</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="s2">&quot;dense_rank&quot;</span><span class="p">,</span> <span class="s2">&quot;as&quot;</span><span class="p">:</span> <span class="s2">&quot;genus_rank&quot;</span><span class="p">}],</span>
        <span class="n">sort</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;total_relative_importance&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="s2">&quot;descending&quot;</span><span class="p">}],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">genus_rank</span> <span class="o">&lt;=</span> <span class="n">select_rank</span><span class="o">.</span><span class="n">genus_rank</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">select_genus</span><span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">heat_map_title</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">heat_map_overlay</span> <span class="o">=</span> <span class="n">importance_heat_map</span><span class="o">.</span><span class="n">mark_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
        <span class="n">neighbourhood_genus_filter</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">opacity</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">neighbourhood_genus_filter</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
<span class="p">)</span>

<span class="n">heat_map_hover</span> <span class="o">=</span> <span class="n">heat_map_overlay</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
        <span class="n">neighbourhood_genus_hover</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">opacity</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">neighbourhood_genus_hover</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
<span class="p">)</span>


<span class="c1"># Create neighbourhood tree distribution detail map</span>

<span class="n">neighbourhood_detail_title</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">TitleParams</span><span class="p">(</span>
    <span class="s2">&quot;Neighbourhood Tree Distribution&quot;</span><span class="p">,</span> <span class="n">fontSize</span><span class="o">=</span><span class="mi">15</span>
<span class="p">)</span>

<span class="n">neighbourhood_map</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">base_calc_chart</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">neighbourhood_genus_filter</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_lookup</span><span class="p">(</span>
        <span class="n">lookup</span><span class="o">=</span><span class="s2">&quot;neighbourhood_name&quot;</span><span class="p">,</span>
        <span class="n">from_</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">LookupData</span><span class="p">(</span><span class="n">data_geojson_remote</span><span class="p">,</span> <span class="s2">&quot;properties.name&quot;</span><span class="p">),</span>
        <span class="n">as_</span><span class="o">=</span><span class="s2">&quot;geom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;datum.geom.geometry&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;datum.geom.type&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mark_geoshape</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">()</span>
    <span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">reflectY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">select_rank</span><span class="p">)</span>

<span class="n">tree_distribution</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">base_calc_chart</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">neighbourhood_genus_filter</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
        <span class="n">tree_url</span><span class="o">=</span><span class="s2">&quot;https://maps.google.com/?q=&quot;</span>
        <span class="o">+</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">latitude</span>
        <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
        <span class="o">+</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">longitude</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">latitude</span><span class="o">=</span><span class="s2">&quot;latitude:Q&quot;</span><span class="p">,</span>
        <span class="n">longitude</span><span class="o">=</span><span class="s2">&quot;longitude:Q&quot;</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">&quot;tree_id:N&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tree ID&quot;</span><span class="p">),</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">&quot;genus_name:N&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Genus&quot;</span><span class="p">),</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">&quot;diameter_m:Q&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Diameter (m)&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2&quot;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;genus_name:N&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Genus&quot;</span><span class="p">)),</span>
        <span class="n">href</span><span class="o">=</span><span class="s2">&quot;tree_url:N&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">neighbourhood_genus_filter</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create overview map</span>
<span class="n">neighbourhood_overview_overlay</span> <span class="o">=</span> <span class="n">neighbourhood_map</span><span class="o">.</span><span class="n">mark_geoshape</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">stroke</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">neighbourhood_overview</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">neighbourhood_importance_map</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;#54a24b&quot;</span><span class="p">),</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">neighbourhood_overview_overlay</span>
<span class="p">)</span>

<span class="n">dashboard_title</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">TitleParams</span><span class="p">(</span><span class="s1">&#39;Vancouver Street Tree Genus Importance and Tree Distribution by Neighbourhood&#39;</span><span class="p">,</span> 
                                  <span class="n">fontSize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> 
                                  <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                                 <span class="p">)</span>
<span class="n">final_dashboard</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span>
        <span class="n">importance_heat_map</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">neighbourhood_genus_filter</span><span class="p">)</span>
        <span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">neighbourhood_genus_hover</span><span class="p">)</span>
        <span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">select_rank</span><span class="p">)</span>
        <span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">select_genus</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">heat_map_overlay</span>
        <span class="o">+</span> <span class="n">heat_map_hover</span>
    <span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="o">|</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">neighbourhood_map</span> <span class="o">+</span> <span class="n">tree_distribution</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">neighbourhood_detail_title</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">neighbourhood_overview</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">resolve_scale</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;independent&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;independent&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">configure_view</span><span class="p">(</span><span class="n">strokeWidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">dashboard_title</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;final_dashboard&quot;</span><span class="p">,</span><span class="n">final_dashboard</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-default" id="final-dashboard">
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-466fac97be7f40748a648766d48e64f5"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-466fac97be7f40748a648766d48e64f5") {
      outputDiv = document.getElementById("altair-viz-466fac97be7f40748a648766d48e64f5");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300, "strokeWidth": 0}}, "hconcat": [{"layer": [{"mark": {"type": "rect", "stroke": "black", "strokeWidth": 2}, "encoding": {"color": {"aggregate": "sum", "field": "relative_importance", "legend": {"format": "%", "orient": "top", "title": "Relative importance"}, "scale": {"scheme": "yellowgreen"}, "type": "quantitative"}, "tooltip": [{"aggregate": "sum", "field": "relative_importance", "format": ".2%", "title": "Relative importance", "type": "quantitative"}, {"field": "neighbourhood_name", "title": "Neighbourhood", "type": "nominal"}, {"field": "genus_name", "title": "Genus", "type": "nominal"}], "x": {"field": "neighbourhood_name", "sort": "-color", "title": "Neighbourhood", "type": "nominal"}, "y": {"field": "genus_name", "sort": "color", "title": "Genus", "type": "nominal"}}, "selection": {"selector004": {"type": "multi", "fields": ["neighbourhood_name", "genus_name"], "empty": "none", "init": [{"neighbourhood_name": "Kensington-Cedar Cottage", "genus_name": "PRUNUS"}, {"neighbourhood_name": "Kensington-Cedar Cottage", "genus_name": "ACER"}]}, "selector005": {"type": "single", "fields": ["neighbourhood_name", "genus_name"], "on": "mouseover", "empty": "none"}, "selector006": {"type": "single", "fields": ["genus_rank"], "bind": {"input": "range", "max": 80, "min": 1, "name": "Genus importance rank:"}, "init": {"genus_rank": 80}}, "selector007": {"type": "single", "fields": ["genus_name"], "bind": {"input": "select", "options": ["ABIES", "ACER", "AESCULUS", "AILANTHUS", "ALNUS", "AMELANCHIER", "ARAUCARIA", "BETULA", "CALOCEDRUS", "CARPINUS", "CASTANEA", "CATALPA", "CEDRUS", "CELTIS", "CERCIDIPHYLLUM", "CERCIS", "CHAMAECYPARIS", "CHITALPA", "CLADRASTIS", "CORNUS", "CORYLUS", "CRATAEGUS", "CRYPTOMERIA", "DAVIDIA", "EUCOMMIA", "EUONYMUS", "FAGUS", "FICUS", "FRAXINUS", "GINKGO", "GLEDITSIA", "GYMNOCLADUS", "HIBISCUS", "ILEX", "JUGLANS", "JUNIPERUS", "KOELREUTERIA", "LABURNUM", "LARIX", "LAURUS", "LIQUIDAMBAR", "LIRIODENDRON", "MAGNOLIA", "MALUS", "MANGLIETIA", "MESPILUS", "METASEQUOIA", "NOTHOFAGUS", "NYSSA", "OSTRYIA", "OXYDENDRUM", "PARROTIA", "PAULOWNIA", "PICEA", "PINUS", "PLATANUS", "POPULUS", "PRUNUS", "PSEUDOTSUGA", "PTELEA", "PTEROCARYA", "PYRUS", "QUERCUS", "RHAMNUS", "RHUS", "ROBINIA", "SALIX", "SCIADOPITYS", "SEQUOIA", "SEQUOIADENDRON", "SOPHORA", "SORBUS", "STEWARTIA", "STYRAX", "SYRINGA", "TAXUS", "THUJA", "TILIA", "TRACHYCARPUS", "TSUGA", "ULMUS", "ZELKOVA"], "name": "Genus selection:"}}}, "title": {"text": "Genus importance distribution by neighbourhood", "fontSize": 15}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"window": [{"op": "dense_rank", "as": "genus_rank"}], "sort": [{"field": "total_relative_importance", "order": "descending"}]}, {"filter": "(datum.genus_rank <= selector006.genus_rank)"}, {"filter": {"selection": "selector007"}}]}, {"mark": {"type": "rect", "fill": null, "strokeWidth": 4}, "encoding": {"color": {"aggregate": "sum", "field": "relative_importance", "legend": {"format": "%", "orient": "top", "title": "Relative importance"}, "scale": {"scheme": "yellowgreen"}, "type": "quantitative"}, "opacity": {"condition": {"value": 1, "selection": "selector004"}, "value": 0}, "stroke": {"condition": {"value": "red", "selection": "selector004"}, "value": "black"}, "tooltip": [{"aggregate": "sum", "field": "relative_importance", "format": ".2%", "title": "Relative importance", "type": "quantitative"}, {"field": "neighbourhood_name", "title": "Neighbourhood", "type": "nominal"}, {"field": "genus_name", "title": "Genus", "type": "nominal"}], "x": {"field": "neighbourhood_name", "sort": "-color", "title": "Neighbourhood", "type": "nominal"}, "y": {"field": "genus_name", "sort": "color", "title": "Genus", "type": "nominal"}}, "title": {"text": "Genus importance distribution by neighbourhood", "fontSize": 15}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"window": [{"op": "dense_rank", "as": "genus_rank"}], "sort": [{"field": "total_relative_importance", "order": "descending"}]}, {"filter": "(datum.genus_rank <= selector006.genus_rank)"}, {"filter": {"selection": "selector007"}}]}, {"mark": {"type": "rect", "fill": null, "strokeWidth": 4}, "encoding": {"color": {"aggregate": "sum", "field": "relative_importance", "legend": {"format": "%", "orient": "top", "title": "Relative importance"}, "scale": {"scheme": "yellowgreen"}, "type": "quantitative"}, "opacity": {"condition": {"value": 1, "selection": "selector005"}, "value": 0}, "stroke": {"condition": {"value": "red", "selection": "selector005"}, "value": "black"}, "tooltip": [{"aggregate": "sum", "field": "relative_importance", "format": ".2%", "title": "Relative importance", "type": "quantitative"}, {"field": "neighbourhood_name", "title": "Neighbourhood", "type": "nominal"}, {"field": "genus_name", "title": "Genus", "type": "nominal"}], "x": {"field": "neighbourhood_name", "sort": "-color", "title": "Neighbourhood", "type": "nominal"}, "y": {"field": "genus_name", "sort": "color", "title": "Genus", "type": "nominal"}}, "title": {"text": "Genus importance distribution by neighbourhood", "fontSize": 15}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"joinaggregate": [{"op": "sum", "field": "relative_importance", "as": "total_relative_importance"}], "groupby": ["genus_name"]}, {"window": [{"op": "dense_rank", "as": "genus_rank"}], "sort": [{"field": "total_relative_importance", "order": "descending"}]}, {"filter": "(datum.genus_rank <= selector006.genus_rank)"}, {"filter": {"selection": "selector007"}}]}], "height": 700, "width": 300}, {"vconcat": [{"layer": [{"mark": {"type": "geoshape", "color": "white", "fill": null, "stroke": "black", "strokeWidth": 1}, "encoding": {}, "height": 450, "projection": {"reflectY": true, "type": "identity"}, "selection": {"selector006": {"type": "single", "fields": ["genus_rank"], "bind": {"input": "range", "max": 80, "min": 1, "name": "Genus importance rank:"}, "init": {"genus_rank": 80}}}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"filter": {"selection": "selector004"}}, {"lookup": "neighbourhood_name", "as": "geom", "from": {"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson", "format": {"property": "features", "type": "json"}}, "key": "properties.name"}}, {"calculate": "datum.geom.geometry", "as": "geometry"}, {"calculate": "datum.geom.type", "as": "type"}]}, {"mark": {"type": "circle", "color": "green", "size": 20, "strokeWidth": 0}, "encoding": {"color": {"field": "genus_name", "legend": {"title": "Genus"}, "type": "nominal"}, "href": {"field": "tree_url", "type": "nominal"}, "latitude": {"field": "latitude", "type": "quantitative"}, "longitude": {"field": "longitude", "type": "quantitative"}, "tooltip": [{"field": "tree_id", "title": "Tree ID", "type": "nominal"}, {"field": "genus_name", "title": "Genus", "type": "nominal"}, {"field": "diameter_m", "format": ".2", "title": "Diameter (m)", "type": "quantitative"}]}, "selection": {"selector004": {"type": "multi", "fields": ["neighbourhood_name", "genus_name"], "empty": "none", "init": [{"neighbourhood_name": "Kensington-Cedar Cottage", "genus_name": "PRUNUS"}, {"neighbourhood_name": "Kensington-Cedar Cottage", "genus_name": "ACER"}]}}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"filter": {"selection": "selector004"}}, {"calculate": "((('https://maps.google.com/?q=' + datum.latitude) + ',') + datum.longitude)", "as": "tree_url"}]}], "title": {"text": "Neighbourhood Tree Distribution", "fontSize": 15}}, {"layer": [{"mark": {"type": "geoshape", "stroke": "black", "strokeWidth": 4}, "encoding": {"color": {"value": "#54a24b"}, "strokeWidth": {"value": 2}, "tooltip": {"field": "neighbourhood_name", "title": "Neighbourhood", "type": "nominal"}}, "height": 200, "projection": {"reflectY": true, "type": "identity"}, "title": "", "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"lookup": "neighbourhood_name", "as": "geom", "from": {"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson", "format": {"property": "features", "type": "json"}}, "key": "properties.name"}}, {"aggregate": [{"op": "sum", "field": "importance_value", "as": "neighbourhood_importance"}, {"op": "median", "field": "longitude", "as": "median_longitude"}, {"op": "median", "field": "latitude", "as": "median_latitude"}], "groupby": ["neighbourhood_name", "geom"]}, {"lookup": "neighbourhood_name", "as": "land_area_ha", "from": {"data": {"url": "https://raw.githubusercontent.com/Daniel-J-Stevens/data-science-toolbox_assignment-8/main/van-trees_book/data/neighbourhood_demographics.csv"}, "key": "neighbourhood_name", "fields": ["land_area"]}}, {"calculate": "datum.geom.geometry", "as": "geometry"}, {"calculate": "datum.geom.type", "as": "type"}, {"calculate": "0", "as": "text_x"}, {"calculate": "datum.land_area_ha/100", "as": "land_area_km2"}, {"calculate": "(datum.neighbourhood_importance/datum.land_area_km2)*100", "as": "importance_per_km2"}, {"window": [{"op": "rank", "as": "importance_rank"}], "sort": [{"field": "importance_per_km2", "order": "descending"}]}], "width": 400}, {"mark": {"type": "geoshape", "fill": null}, "encoding": {"stroke": {"value": "red"}, "strokeWidth": {"value": 4}}, "height": 450, "projection": {"reflectY": true, "type": "identity"}, "selection": {"selector006": {"type": "single", "fields": ["genus_rank"], "bind": {"input": "range", "max": 80, "min": 1, "name": "Genus importance rank:"}, "init": {"genus_rank": 80}}}, "transform": [{"filter": {"not": {"field": "tree_id", "oneOf": [43236, 158784, 191867, 188673, 188672, 222821, 85182, 93845, 71403, 128151, 23759, 78588, 51001, 149285, 255981, 264928, 256165, 255911, 270750, 59956, 256819, 256822, 256701, 256717, 256719, 256890, 256653, 256706, 256803, 201285, 227312, 256183, 255969, 256270, 141289, 256896, 267123, 263937, 255068, 257203, 256894, 257095, 257093]}}}, {"calculate": "datum.diameter*0.0254", "as": "diameter_m"}, {"calculate": "pow(datum.diameter_m/2,2)*PI", "as": "basal_area"}, {"joinaggregate": [{"op": "sum", "field": "basal_area", "as": "total_basal_area"}, {"op": "count", "field": "tree_id", "as": "total_count"}]}, {"calculate": "datum.basal_area/datum.total_basal_area", "as": "relative_dominance"}, {"calculate": "1/datum.total_count", "as": "relative_abundance"}, {"calculate": "datum.relative_dominance + datum.relative_abundance", "as": "importance_value"}, {"joinaggregate": [{"op": "sum", "field": "importance_value", "as": "total_importance"}]}, {"calculate": "datum.importance_value/datum.total_importance", "as": "relative_importance"}, {"filter": {"selection": "selector004"}}, {"lookup": "neighbourhood_name", "as": "geom", "from": {"data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/local-area-boundary.geojson", "format": {"property": "features", "type": "json"}}, "key": "properties.name"}}, {"calculate": "datum.geom.geometry", "as": "geometry"}, {"calculate": "datum.geom.type", "as": "type"}]}]}], "resolve": {"scale": {"x": "independent", "y": "independent"}}}], "data": {"url": "https://raw.githubusercontent.com/UBC-MDS/exploratory-data-viz/main/data/vancouver_trees.csv"}, "title": {"text": "Vancouver Street Tree Genus Importance and Tree Distribution by Neighbourhood", "align": "left", "fontSize": 20}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"mode": "vega-lite"});
</script></div></div>
<figcaption>
<p><span class="caption-number">Fig. 28 </span><span class="caption-text">Tree importance distribution by neighbourhood
``</span><a class="headerlink" href="#final-dashboard" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../docs/analysis_intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Introduction</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../docs/analysis_discussion.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Discussion</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Daniel Stevens<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>